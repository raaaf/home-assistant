# ============================================================================
# ADAPTIVE LIGHTING CONFIGURATION
# ============================================================================
#
# Home Assistant Adaptive Lighting component configurations for all rooms
# Optimized for Bavarian climate, daily routines, and circadian rhythm health
# UPDATED: Optimized for Zigbee2MQTT with mixed Philips Hue & IKEA lights
# FIXED: Disabled detect_non_ha_changes to prevent random light turn-ons (2025-12-05)
#
# Key principles:
# - Sleep color temps at 1800K for optimal circadian rhythm support
# - Room-specific timing based on usage patterns
# - IKEA-compatible transitions (10-15s max) to prevent bulb lockups
# - Separate commands for IKEA lights to avoid simultaneous brightness/color changes
# - Higher brightness for safety areas (bathrooms, hallways)
# - Extended evening hours for work and outdoor spaces
# - detect_non_ha_changes: false prevents Z2M state polling from triggering lights
# - adapt_delay: 1 gives Zigbee network time to settle before adaptation

# =============================================================================
# LIVING SPACES - Primary family areas with extended evening usage
# =============================================================================

- name: "Wohnzimmer"
  lights:
    # Wohnzimmer Wand (6 lights)
    - light.wohnzimmer_wand_1
    - light.wohnzimmer_wand_2
    - light.wohnzimmer_wand_3
    - light.wohnzimmer_wand_4
    - light.wohnzimmer_wand_5
    - light.wohnzimmer_wand_6
    # Wohnzimmer Esstisch (3 lights)
    - light.wohnzimmer_esstisch_1
    - light.wohnzimmer_esstisch_2
    - light.wohnzimmer_esstisch_3
    # Wohnzimmer Spielematte (4 lights)
    - light.wohnzimmer_spielematte_1
    - light.wohnzimmer_spielematte_2
    - light.wohnzimmer_spielematte_3
    - light.wohnzimmer_spielematte_4
    # Wohnzimmer Schrank (3 lights)
    - light.wohnzimmer_schrank_1
    - light.wohnzimmer_schrank_2
    - light.wohnzimmer_schrank_3
    # Individual light
    - light.wohnzimmer_spieletisch
  interval: 300  # 5 min - reduced traffic while maintaining smoothness
  transition: 10  # Short transitions prevent IKEA lockups
  initial_transition: 1  # Prevents color flashing
  min_brightness: 10
  max_brightness: 100
  min_color_temp: 2200 # IKEA/Hue compatible warm minimum
  max_color_temp: 4000 # IKEA maximum cool white
  prefer_rgb_color: false
  sleep_brightness: 10 # Consistent across all rooms
  sleep_color_temp: 2200  # Warmest supported by all bulbs
  sleep_transition: 10 # Short transitions prevent IKEA lockups
  transition_until_sleep: true
  min_sunrise_time: "05:00:00"
  max_sunrise_time: "07:00:00" # Peak brightness/coolness at wake time
  min_sunset_time: "20:00:00"  # Dynamic: Overridden by automation based on sleep time
  max_sunset_time: "20:30:00"
  take_over_control: true
  detect_non_ha_changes: false  # Disabled - prevents random turn-ons with Z2M state updates
  autoreset_control_seconds: 3600
  only_once: false
  adapt_only_on_bare_turn_on: false
  separate_turn_on_commands: true   # Enabled for IKEA bulb compatibility
  send_split_delay: 50  # 50ms between commands per official docs
  adapt_delay: 1  # Small delay lets Zigbee network settle before adaptation
  skip_redundant_commands: true
  intercept: true
  multi_light_intercept: true
  include_config_in_attributes: true
  brightness_mode: "tanh"

- name: "K端che"
  lights:
    # K端che Decke (2 lights)
    - light.kuche_decke_1
    - light.kuche_decke_2
    # K端che Insel (2 lights)
    - light.kuche_insel_oben
    - light.kuche_insel_unten
    # K端che Schrank (2 lights)
    - light.kuche_schrank_1
    - light.kuche_schrank_2
  interval: 300  # 5 min - reduced traffic while maintaining smoothness
  transition: 10  # Short transitions prevent IKEA lockups
  initial_transition: 1  # Prevents color flashing
  min_brightness: 10
  max_brightness: 100
  min_color_temp: 2200 # IKEA/Hue compatible warm minimum
  max_color_temp: 4000 # IKEA maximum cool white
  prefer_rgb_color: false
  sleep_brightness: 10 # Consistent across all rooms
  sleep_color_temp: 2200  # Warmest supported by all bulbs
  sleep_transition: 45  # Optimized for IKEA compatibility
  transition_until_sleep: true
  min_sunrise_time: "05:00:00" # Aligned with wake time
  max_sunrise_time: "07:00:00" # Peak brightness/coolness at wake time
  min_sunset_time: "20:00:00"  # Dynamic: Overridden by automation based on sleep time
  max_sunset_time: "20:30:00"
  take_over_control: true
  detect_non_ha_changes: false  # Disabled - prevents random turn-ons with Z2M state updates
  autoreset_control_seconds: 3600
  only_once: false
  adapt_only_on_bare_turn_on: false
  separate_turn_on_commands: true   # Enabled for IKEA bulb compatibility
  send_split_delay: 50  # 50ms between commands per official docs
  adapt_delay: 1  # Small delay lets Zigbee network settle before adaptation
  skip_redundant_commands: true
  intercept: true
  multi_light_intercept: true
  include_config_in_attributes: true
  brightness_mode: "tanh"

# =============================================================================
# BEDROOMS - Sleep-optimized with gentle transitions and early sunset times
# =============================================================================

- name: "Schlafzimmer"
  lights:
    # Schlafzimmer Decke (2 lights)
    - light.schlafzimmer_decke_1
    - light.schlafzimmer_decke_2
    # Individual lights
    - light.schlafzimmer_bett
    - light.schlafzimmer_tv
  interval: 300  # 5 min - reduced traffic while maintaining smoothness
  transition: 10  # Short transitions prevent IKEA lockups
  initial_transition: 1  # Prevents color flashing
  min_brightness: 10
  max_brightness: 100
  min_color_temp: 2200 # IKEA/Hue compatible warm minimum
  max_color_temp: 4000 # IKEA maximum cool white
  prefer_rgb_color: false
  sleep_brightness: 10 # Consistent across all rooms
  sleep_color_temp: 2200  # Warmest supported by all bulbs
  sleep_transition: 10 # Short transitions prevent IKEA lockups
  transition_until_sleep: true
  min_sunrise_time: "05:00:00"
  max_sunrise_time: "07:00:00" # Peak brightness/coolness at wake time
  min_sunset_time: "20:00:00"  # Dynamic: Overridden by automation based on sleep time
  max_sunset_time: "20:30:00"
  take_over_control: true
  detect_non_ha_changes: false  # Disabled - prevents random turn-ons with Z2M state updates
  autoreset_control_seconds: 3600
  only_once: false
  adapt_only_on_bare_turn_on: false
  separate_turn_on_commands: true   # Enabled for IKEA bulb compatibility
  send_split_delay: 50  # 50ms between commands per official docs
  adapt_delay: 1  # Small delay lets Zigbee network settle before adaptation
  skip_redundant_commands: true
  intercept: true
  multi_light_intercept: true
  include_config_in_attributes: true
  brightness_mode: "tanh"

- name: "Kinderzimmer"
  lights:
    - light.kinderzimmer_decke            # Einzellicht (Hauptlicht)
    - light.kinderzimmer_bucher           # Einzellicht (Leselicht)
    - light.kinderzimmer_schrank          # Einzellicht (Akzentlicht)
  interval: 300  # 5 min - reduced traffic while maintaining smoothness
  transition: 10  # Short transitions prevent IKEA lockups
  initial_transition: 1  # Prevents color flashing
  min_brightness: 10
  max_brightness: 100
  min_color_temp: 2200 # IKEA/Hue compatible warm minimum
  max_color_temp: 4000 # IKEA maximum cool white
  prefer_rgb_color: false
  sleep_brightness: 10 # Consistent across all rooms
  sleep_color_temp: 2200  # Warmest supported by all bulbs
  sleep_transition: 10 # Short transitions prevent IKEA lockups
  transition_until_sleep: true
  min_sunrise_time: "05:00:00"
  max_sunrise_time: "07:00:00" # Peak brightness/coolness at wake time
  min_sunset_time: "20:00:00"  # Dynamic: Overridden by automation based on sleep time
  max_sunset_time: "20:30:00"
  take_over_control: true
  detect_non_ha_changes: false  # Disabled - prevents random turn-ons with Z2M state updates
  autoreset_control_seconds: 3600
  only_once: false
  adapt_only_on_bare_turn_on: false
  separate_turn_on_commands: true   # Enabled for IKEA bulb compatibility
  send_split_delay: 50  # 50ms between commands per official docs
  adapt_delay: 1  # Small delay lets Zigbee network settle before adaptation
  skip_redundant_commands: true
  intercept: true
  multi_light_intercept: true
  include_config_in_attributes: true
  brightness_mode: "tanh"

# =============================================================================
# BATHROOMS & UTILITY - Safety-focused with higher night brightness
# =============================================================================

- name: "Badezimmer"
  lights:
    # Badezimmer Decke (2 lights)
    - light.badezimmer_decke_1
    - light.badezimmer_decke_2
    # Individual lights
    - light.badezimmer_schrank
    - light.badezimmer_fenster
  interval: 300  # 5 min - reduced traffic while maintaining smoothness
  transition: 10  # Short transitions prevent IKEA lockups
  initial_transition: 1  # Prevents color flashing
  min_brightness: 10
  max_brightness: 100
  min_color_temp: 2200 # IKEA/Hue compatible warm minimum
  max_color_temp: 4000 # IKEA maximum cool white
  prefer_rgb_color: false
  sleep_brightness: 10 # Consistent across all rooms
  sleep_color_temp: 2200  # Warmest supported by all bulbs
  sleep_transition: 45  # Optimized for IKEA compatibility
  transition_until_sleep: true
  min_sunrise_time: "05:00:00" # Aligned with wake time
  max_sunrise_time: "07:00:00" # Peak brightness/coolness at wake time
  min_sunset_time: "20:00:00"  # Dynamic: Overridden by automation based on sleep time
  max_sunset_time: "20:30:00"
  take_over_control: true
  detect_non_ha_changes: false  # Disabled - prevents random turn-ons with Z2M state updates
  autoreset_control_seconds: 7200 # 2 hours for less frequently used rooms
  only_once: false
  adapt_only_on_bare_turn_on: false
  separate_turn_on_commands: true   # Enabled for IKEA bulb compatibility
  send_split_delay: 50  # 50ms between commands per official docs
  adapt_delay: 1  # Small delay lets Zigbee network settle before adaptation
  skip_redundant_commands: true
  intercept: true
  multi_light_intercept: true
  include_config_in_attributes: true
  brightness_mode: "tanh"

- name: "Waschzimmer"
  lights:
    - light.waschzimmer_decke
  interval: 300  # 5 min - reduced traffic while maintaining smoothness
  transition: 10  # Short transitions prevent IKEA lockups
  initial_transition: 1  # Prevents color flashing
  min_brightness: 10
  max_brightness: 100
  min_color_temp: 2200 # IKEA/Hue compatible warm minimum
  max_color_temp: 4000 # IKEA maximum cool white
  prefer_rgb_color: false
  sleep_brightness: 10 # Consistent across all rooms
  sleep_color_temp: 2200  # Warmest supported by all bulbs
  sleep_transition: 10 # Short transitions prevent IKEA lockups
  transition_until_sleep: true
  min_sunrise_time: "05:00:00"
  max_sunrise_time: "07:00:00" # Peak brightness/coolness at wake time
  min_sunset_time: "20:00:00"  # Dynamic: Overridden by automation based on sleep time
  max_sunset_time: "20:30:00"
  take_over_control: true
  detect_non_ha_changes: false  # Disabled - prevents random turn-ons with Z2M state updates
  autoreset_control_seconds: 7200
  only_once: false
  adapt_only_on_bare_turn_on: false
  separate_turn_on_commands: true   # Enabled for IKEA bulb compatibility
  send_split_delay: 50  # 50ms between commands per official docs
  adapt_delay: 1  # Small delay lets Zigbee network settle before adaptation
  skip_redundant_commands: true
  intercept: true
  multi_light_intercept: true
  include_config_in_attributes: true
  brightness_mode: "tanh"

# =============================================================================
# WORK & DRESSING AREAS - Productivity-optimized with extended evening hours
# =============================================================================

- name: "Arbeitszimmer"
  lights:
    # Individual light
    - light.arbeitszimmer_decke
    # Arbeitszimmer PC (2 lights)
    - light.arbeitszimmer_pc_1
    - light.arbeitszimmer_pc_2
    # Individual light
    - light.arbeitszimmer_stehlampe
  interval: 300  # 5 min - reduced traffic while maintaining smoothness
  transition: 10  # Short transitions prevent IKEA lockups
  initial_transition: 1  # Prevents color flashing
  min_brightness: 10
  max_brightness: 100
  min_color_temp: 2200 # IKEA/Hue compatible warm minimum
  max_color_temp: 4000 # IKEA maximum cool white
  prefer_rgb_color: false
  sleep_brightness: 10 # Consistent across all rooms
  sleep_color_temp: 2200  # Warmest supported by all bulbs
  sleep_transition: 10 # Short transitions prevent IKEA lockups
  transition_until_sleep: true
  min_sunrise_time: "05:00:00" # Aligned with wake time
  max_sunrise_time: "07:00:00" # Peak brightness/coolness at wake time
  min_sunset_time: "20:00:00"  # Dynamic: Overridden by automation based on sleep time
  max_sunset_time: "20:30:00"
  take_over_control: true
  detect_non_ha_changes: false  # Disabled - prevents random turn-ons with Z2M state updates
  autoreset_control_seconds: 3600
  only_once: false
  adapt_only_on_bare_turn_on: false
  separate_turn_on_commands: true   # Enabled for IKEA bulb compatibility
  send_split_delay: 50  # 50ms between commands per official docs
  adapt_delay: 1  # Small delay lets Zigbee network settle before adaptation
  skip_redundant_commands: true
  intercept: true
  multi_light_intercept: true
  include_config_in_attributes: true
  brightness_mode: "tanh"

- name: "Ankleide"
  lights:
    # Ankleide Decke (2 lights)
    - light.ankleide_decke_1
    - light.ankleide_decke_2
  interval: 300  # 5 min - reduced traffic while maintaining smoothness
  transition: 10  # Short transitions prevent IKEA lockups
  initial_transition: 1  # Prevents color flashing
  min_brightness: 10
  max_brightness: 100
  min_color_temp: 2200 # IKEA/Hue compatible warm minimum
  max_color_temp: 4000 # IKEA maximum cool white
  prefer_rgb_color: false
  sleep_brightness: 10 # Consistent across all rooms
  sleep_color_temp: 2200  # Warmest supported by all bulbs
  sleep_transition: 45  # Optimized for IKEA compatibility
  transition_until_sleep: true
  min_sunrise_time: "05:00:00" # Aligned with wake time
  max_sunrise_time: "07:00:00" # Peak brightness/coolness at wake time
  min_sunset_time: "20:00:00"  # Dynamic: Overridden by automation based on sleep time
  max_sunset_time: "20:30:00"
  take_over_control: true
  detect_non_ha_changes: false  # Disabled - prevents random turn-ons with Z2M state updates
  autoreset_control_seconds: 7200
  only_once: false
  adapt_only_on_bare_turn_on: false
  separate_turn_on_commands: true   # Enabled for IKEA bulb compatibility
  send_split_delay: 50  # 50ms between commands per official docs
  adapt_delay: 1  # Small delay lets Zigbee network settle before adaptation
  skip_redundant_commands: true
  intercept: true
  multi_light_intercept: true
  include_config_in_attributes: true
  brightness_mode: "tanh"

# =============================================================================
# TRANSITION AREAS - Motion-activated spaces with quick transitions
# =============================================================================

- name: "Flur"
  lights:
    # Flur Decke (6 lights)
    - light.flur_decke_1
    - light.flur_decke_2
    - light.flur_decke_3
    - light.flur_decke_4
    - light.flur_decke_5
    - light.flur_decke_6
    # Flur Schrank (2 lights)
    - light.flur_schrank_1
    - light.flur_schrank_2
    - light.stahltraeger
  interval: 300  # 5 min - reduced traffic while maintaining smoothness
  transition: 10  # Short transitions prevent IKEA lockups
  initial_transition: 1  # Prevents color flashing
  min_brightness: 10
  max_brightness: 100
  min_color_temp: 2200 # IKEA/Hue compatible warm minimum
  max_color_temp: 4000 # IKEA maximum cool white
  prefer_rgb_color: false
  sleep_brightness: 10 # Consistent across all rooms
  sleep_color_temp: 2200  # Warmest supported by all bulbs
  sleep_transition: 10 # Short transitions prevent IKEA lockups
  transition_until_sleep: true
  min_sunrise_time: "05:00:00"
  max_sunrise_time: "07:00:00" # Peak brightness/coolness at wake time
  min_sunset_time: "20:00:00"  # Dynamic: Overridden by automation based on sleep time
  max_sunset_time: "20:30:00"
  take_over_control: true
  detect_non_ha_changes: false  # Disabled - prevents random turn-ons with Z2M state updates
  autoreset_control_seconds: 7200
  only_once: false
  adapt_only_on_bare_turn_on: false
  separate_turn_on_commands: true   # Enabled for IKEA bulb compatibility
  send_split_delay: 50  # 50ms between commands per official docs
  adapt_delay: 1  # Small delay lets Zigbee network settle before adaptation
  skip_redundant_commands: true
  intercept: true
  multi_light_intercept: true
  include_config_in_attributes: true
  brightness_mode: "tanh"

# =============================================================================
# OUTDOOR AREAS - Extended evening hours with slower transitions
# =============================================================================

- name: "Balkon"
  lights:
    # Balkon Wand (2 lights)
    - light.balkon_wand_1
    - light.balkon_wand_2
    # Individual light
    - light.balkon_blumen
  interval: 300  # 5 min - reduced traffic while maintaining smoothness
  transition: 10  # Short transitions prevent IKEA lockups
  initial_transition: 1  # Prevents color flashing
  min_brightness: 10 # Lower minimum for outdoor ambiance
  max_brightness: 100
  min_color_temp: 2200 # IKEA/Hue compatible warm minimum
  max_color_temp: 4000 # IKEA maximum cool white
  prefer_rgb_color: false
  sleep_brightness: 10 # Consistent across all rooms
  sleep_color_temp: 2200  # Warmest supported by all bulbs
  sleep_transition: 10 # Short transitions prevent IKEA lockups
  transition_until_sleep: false # No sleep transition for outdoor
  min_sunrise_time: "05:00:00" # Aligned with wake time
  max_sunrise_time: "07:00:00" # Peak brightness/coolness at wake time
  min_sunset_time: "20:00:00"  # Dynamic: Overridden by automation based on sleep time
  max_sunset_time: "20:30:00"
  take_over_control: true
  detect_non_ha_changes: false  # Disabled - prevents random turn-ons with Z2M state updates
  autoreset_control_seconds: 7200 # Longer reset for outdoor
  only_once: false
  adapt_only_on_bare_turn_on: false
  separate_turn_on_commands: true   # Enabled for IKEA bulb compatibility
  send_split_delay: 50  # 50ms between commands per official docs
  adapt_delay: 1  # Small delay lets Zigbee network settle before adaptation
  skip_redundant_commands: true
  intercept: true
  multi_light_intercept: true
  include_config_in_attributes: true
  brightness_mode: "tanh" # Smooth transitions for outdoor
