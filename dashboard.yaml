views:
  - theme: Backend-selected
    title: Home
    id: home
    icon: ''
    type: custom:layout-card
    layout_type: custom:grid-layout
    layout_options:
      grid-template-columns: 10% 80% 10%
      grid-template-rows: auto
      grid-template-areas: |
        "left middle right"
    badges: []
    cards:
      - type: custom:gap-card
        view_layout:
          grid:area: left
      - type: custom:layout-card
        view_layout:
          grid:area: middle
        layout_type: custom:masonry-layout
        layout:
          max_width: 1000
          width: 400
        cards:
          - type: custom:mushroom-title-card
            alignment: center
            title: |-
              {% set time = now().hour %}
              {% if (time >= 18) %} 
               Guten Abend, {{user}}!
              {% elif (time >= 12) %}
               Guten Nachmittag, {{user}}!
              {% elif (time >= 5) %}
               Guten Morgen, {{user}}!
              {% else %}
               Hallo, {{user}}
              {% endif %}
            subtitle: Batzabutza
          - type: custom:mushroom-chips-card
            alignment: center
            chips:
              - type: entity
                entity: sensor.temperatur_aussen
              - type: entity
                entity: sensor.what_to_wear_outside
                icon: mdi:tshirt-v
              - type: entity
                entity: sensor.sunlight_pct
                icon: mdi:sunglasses
              - type: entity
                entity: sensor.night_state
                icon: mdi:weather-night
              - type: entity
                entity: sensor.balkon_motion_illuminance
              - type: entity
                entity: sensor.season
              - type: entity
                entity: person.rafael
                use_entity_picture: true
              - type: entity
                entity: person.alex
                use_entity_picture: true
              - type: entity
                entity: vacuum.robbi_2
              - type: entity
                entity: sensor.count_lights_on
              - type: conditional
                conditions:
                  - entity: sensor.hausverbrauch_gesamt
                    state_not: unavailable
                  - entity: sensor.hausverbrauch_gesamt
                    state_not: unknown
                chip:
                  type: template
                  entity: sensor.hausverbrauch_gesamt
                  icon: mdi:flash
                  icon_color: >-
                    {% set power = states('sensor.hausverbrauch_gesamt') | float(0) %} {% if power < 500 %}
                      green
                    {% elif power < 2000 %}
                      amber
                    {% else %}
                      red
                    {% endif %}

                  content: >-
                    {{ states('sensor.hausverbrauch_gesamt') | float(0) | round(0) }} W

              - type: conditional
                conditions:
                  - entity: sensor.steckdose_bkk_power
                    state_not: unavailable
                  - entity: sensor.steckdose_bkk_power
                    state_not: unknown
                  - condition: template
                    value: "{{ states('sensor.steckdose_bkk_power') | float(0) > 5 }}"
                chip:
                  type: template
                  entity: sensor.steckdose_bkk_power
                  icon: mdi:solar-power
                  icon_color: >-
                    {% set pv = states('sensor.steckdose_bkk_power') | float(0) %} {% if pv > 150 %}
                      amber
                    {% else %}
                      blue
                    {% endif %}

                  content: >-
                    {{ states('sensor.steckdose_bkk_power') | float(0) | round(0) }} W

              - type: conditional
                conditions:
                  - condition: numeric_state
                    entity: sensor.qingping_air_monitor_lite_co2_carbon_dioxide
                    above: 1200
                chip:
                  type: template
                  icon: mdi:molecule-co2
                  icon_color: red
                  content: >-
                    {{states('sensor.qingping_air_monitor_lite_co2_carbon_dioxide')}}

                  entity: sensor.qingping_air_monitor_lite_co2_carbon_dioxide
              - type: conditional
                conditions:
                  - entity: switch.heizung_badezimmer
                    state: 'on'
                chip:
                  type: template
                  icon: mdi:heating-coil
                  icon_color: red
                  content: Badezimmer
                  entity: switch.heizung_badezimmer
              - type: conditional
                conditions:
                  - entity: climate.ac
                    state: cool
                  - entity: climate.ac
                    state_not: unavailable
                  - entity: climate.ac
                    state_not: unknown
                chip:
                  type: template
                  icon: mdi:tailwind
                  icon_color: blue
                  content: Klimaanlage
                  entity: climate.ac
              - type: conditional
                conditions:
                  - entity: switch.heizung_schlafzimmer
                    state: 'on'
                chip:
                  type: template
                  icon: mdi:heating-coil
                  icon_color: red
                  content: Arbeitszimmer
                  entity: switch.heizung_schlafzimmer
              - type: conditional
                conditions:
                  - entity: switch.heizung_wohnzimmer
                    state: 'on'
                chip:
                  type: template
                  icon: mdi:heating-coil
                  icon_color: red
                  content: Wohnzimmer
                  entity: switch.heizung_wohnzimmer
              - type: conditional
                conditions:
                  - entity: switch.heizung_flur
                    state: 'on'
                chip:
                  type: template
                  icon: mdi:heating-coil
                  icon_color: red
                  content: Flur
                  entity: switch.heizung_flur
              - type: conditional
                conditions:
                  - entity: switch.heizung_badezimmer
                    state: 'on'
                chip:
                  type: template
                  icon: mdi:heating-coil
                  icon_color: red
                  content: Badezimmer
                  entity: switch.heizung_badezimmer
              - type: conditional
                conditions:
                  - entity: switch.heizung_kinderzimmer
                    state: 'on'
                chip:
                  type: template
                  icon: mdi:heating-coil
                  icon_color: red
                  content: Kinderzimmer
                  entity: switch.heizung_kinderzimmer
              - type: conditional
                conditions:
                  - entity: fan.arbeitszimmer
                    state: 'on'
                  - entity: fan.arbeitszimmer
                    state_not: unavailable
                  - entity: fan.arbeitszimmer
                    state_not: unknown
                chip:
                  type: template
                  icon: mdi:fan-auto
                  content: Fan AZ
                  entity: fan.arbeitszimmer
              - type: conditional
                conditions:
                  - entity: fan.schlafzimmer
                    state: 'on'
                  - entity: fan.schlafzimmer
                    state_not: unavailable
                  - entity: fan.schlafzimmer
                    state_not: unknown
                chip:
                  type: template
                  icon: mdi:fan-auto
                  content: FAN SZ
                  entity: fan.schlafzimmer
              - type: conditional
                conditions:
                  - entity: fan.luefter
                    state: 'on'
                chip:
                  type: template
                  icon: mdi:fan-auto
                  content: Badezimmer
                  entity: fan.luefter
              - type: conditional
                conditions:
                  - entity: fan.xiaomi_smart_air_purifier_4_pro
                    state: 'on'
                chip:
                  type: template
                  icon: mdi:fan-auto
                  content: Luftreiniger SZ
                  entity: fan.xiaomi_smart_air_purifier_4_pro
              - type: conditional
                conditions:
                  - entity: lock.smart_lock_pro
                    state: unlocked
                chip:
                  type: template
                  icon: mdi:door-open
                  icon_color: yellow
                  content: Wohnungst√ºr aufgeschlossen
                  entity: lock.smart_lock_pro
              - type: conditional
                conditions:
                  - entity: binary_sensor.schlafzimmer_kontaktsensor_contact
                    state: 'on'
                chip:
                  type: template
                  icon: mdi:door-open
                  icon_color: yellow
                  content: Arbeitszimmer
              - type: conditional
                conditions:
                  - entity: binary_sensor.wohnzimmer_kontaktsensor_contact
                    state: 'on'
                chip:
                  type: template
                  icon: mdi:door-open
                  icon_color: yellow
                  content: Wohnzimmer
              - type: conditional
                conditions:
                  - entity: binary_sensor.kuche_kontaktsensor_contact
                    state: 'on'
                chip:
                  type: template
                  icon: mdi:door-open
                  icon_color: yellow
                  content: K√ºche
              - type: conditional
                conditions:
                  - entity: binary_sensor.balkon_kontaktsensor_contact
                    state: 'on'
                chip:
                  type: template
                  icon: mdi:door-open
                  icon_color: yellow
                  content: Balkon
              - type: conditional
                conditions:
                  - entity: binary_sensor.haustur_kontaktsensor_contact
                    state: 'on'
                chip:
                  type: template
                  icon: mdi:door-open
                  icon_color: red
                  content: Wohnungst√ºr ist offen!
              - type: conditional
                conditions:
                  - entity: binary_sensor.arbeitszimmer_kontaktsensor_contact
                    state: 'on'
                chip:
                  type: template
                  icon: mdi:door-open
                  icon_color: yellow
                  content: Schlafzimmer
              - type: conditional
                conditions:
                  - entity: binary_sensor.kinderzimmer_kontaktsensor_contact
                    state: 'on'
                chip:
                  type: template
                  icon: mdi:door-open
                  icon_color: yellow
                  content: Kinderzimmer
              - type: conditional
                conditions:
                  - entity: input_select.waschmaschine
                    state: Arbeitet
                chip:
                  type: template
                  icon: mdi:washing-machine
                  content: WaMa arbeitet
              - type: conditional
                conditions:
                  - entity: input_select.waschmaschine
                    state: Fertig
                chip:
                  type: template
                  icon: mdi:washing-machine
                  content: WaMa fertig
              - type: conditional
                conditions:
                  - entity: input_select.trockner
                    state: Arbeitet
                chip:
                  type: template
                  icon: mdi:washing-machine
                  content: Trockner arbeitet
              - type: conditional
                conditions:
                  - entity: input_select.trockner
                    state: Fertig
                chip:
                  type: template
                  icon: mdi:washing-machine
                  content: Trockner fertig
      - type: custom:gap-card
        view_layout:
          grid:area: right
      - type: custom:gap-card
        view_layout:
          grid:area: left
      - type: custom:layout-card
        view_layout:
          grid:area: middle
        layout_type: custom:masonry-layout
        layout:
          max_width: 1000
          width: 400
        cards:
          - type: custom:layout-card
            layout_type: custom:grid-layout
            layout:
              grid-template-columns: repeat(auto-fit, minmax(320px, 1fr))
              grid-auto-flow: row dense
              grid-gap: 16px
            cards:
              - square: false
                columns: 2
                type: grid
                title: M√ºllabfuhr
                cards:
                  - type: entity
                    entity: sensor.restmuell
                    state_color: true
                  - type: entity
                    entity: sensor.bioabfall
                    state_color: true
                  - type: entity
                    entity: sensor.altpapier
                    state_color: true
                    icon: mdi:delete-empty
                  - type: entity
                    entity: sensor.gelbersack
                    state_color: true
                    icon: mdi:delete-variant
              - type: grid
                title: Waschmaschine & Trockner
                square: false
                columns: 2
                cards:
                  - type: custom:mushroom-entity-card
                    entity: input_select.waschmaschine
                    layout: vertical
                    name: Status
                  - type: custom:mushroom-entity-card
                    entity: input_select.trockner
                    layout: vertical
                    name: Status
                  - type: custom:mushroom-entity-card
                    entity: switch.steckdose_waschmaschine
                    name: Waschmaschine
                    layout: vertical
                  - type: custom:mushroom-entity-card
                    entity: switch.trockner
                    layout: vertical
              - type: grid
                title: Heizung
                square: false
                columns: 2
                cards:
                  - type: conditional
                    conditions:
                      - entity: climate.ac
                        state_not: unavailable
                      - entity: climate.ac
                        state_not: unknown
                    card:
                      type: custom:mushroom-climate-card
                      entity: climate.ac
                      show_temperature_control: true
                      layout: horizontal
                      collapsible_controls: false
                      hvac_modes:
                        - auto
                        - heat
                        - cool
                        - dry
                        - fan_only
                        - 'off'
                  - type: custom:mushroom-entity-card
                    entity: switch.heizung_kinderzimmer
                    name: Kinderzimmer
                    layout: horizontal
                    icon: mdi:heating-coil
                    secondary_info: last-updated
                    icon_color: red
                  - type: custom:mushroom-entity-card
                    entity: switch.heizung_schlafzimmer
                    name: Schlafzimmer
                    layout: horizontal
                    icon: mdi:heating-coil
                    secondary_info: last-updated
                    icon_color: red
                  - type: custom:mushroom-entity-card
                    entity: switch.heizung_wohnzimmer
                    name: Wohnzimmer
                    layout: horizontal
                    icon: mdi:heating-coil
                    secondary_info: last-updated
                    icon_color: red
                  - type: custom:mushroom-entity-card
                    entity: switch.heizung_flur
                    name: Flur
                    layout: horizontal
                    icon: mdi:heating-coil
                    secondary_info: last-updated
                    icon_color: red
                  - type: custom:mushroom-entity-card
                    entity: switch.heizung_badezimmer
                    name: Badezimmer
                    layout: horizontal
                    icon: mdi:heating-coil
                    secondary_info: last-updated
                    icon_color: red
              - type: grid
                title: Fenster / T√ºren
                square: false
                columns: 2
                cards:
                  - type: custom:mushroom-entity-card
                    entity: binary_sensor.kinderzimmer_kontaktsensor_contact
                    name: Kinderzimmer
                    layout: horizontal
                    icon: mdi:door-open
                  - type: custom:mushroom-entity-card
                    entity: binary_sensor.haustur_kontaktsensor_contact
                    name: Haust√ºr
                    layout: horizontal
                    icon: mdi:door-open
                  - type: custom:mushroom-entity-card
                    entity: binary_sensor.balkon_kontaktsensor_contact
                    name: Balkon
                    layout: horizontal
                    icon: mdi:door-open
                  - type: custom:mushroom-entity-card
                    entity: binary_sensor.kuche_kontaktsensor_contact
                    name: K√ºche
                    layout: horizontal
                    icon: mdi:door-open
                  - type: custom:mushroom-entity-card
                    entity: binary_sensor.schlafzimmer_kontaktsensor_contact
                    name: Arbeitszimmer
                    layout: horizontal
                    icon: mdi:door-open
                  - type: custom:mushroom-entity-card
                    entity: binary_sensor.arbeitszimmer_kontaktsensor_contact
                    name: Schlafzimmer
                    layout: horizontal
                    icon: mdi:door-open
                  - type: custom:mushroom-entity-card
                    entity: binary_sensor.wohnzimmer_kontaktsensor_contact
                    name: Fenster
                    layout: horizontal
                    icon: mdi:door-open
              - type: grid
                title: Steckdosen
                square: false
                columns: 2
                cards:
                  - type: custom:mushroom-entity-card
                    entity: switch.wohnzimmer_steckdose
                    name: Wohnzimmer TV
                    layout: horizontal
                  - type: custom:mushroom-entity-card
                    entity: switch.steckdose_kuechengeraete
                    name: Thermomix
                    layout: horizontal
                  - type: custom:mushroom-entity-card
                    entity: switch.steckdose_pc_alex
                    name: PC Alex
                    layout: horizontal
                  - type: custom:mushroom-entity-card
                    entity: switch.steckdose_arbeitszimmer
                    name: Drucker
                    layout: horizontal
                  - type: custom:mushroom-entity-card
                    entity: switch.kuchengerate
                    name: K√ºchenger√§te
                    layout: horizontal
                  - type: custom:mushroom-entity-card
                    entity: switch.arbeitszimmer_steckdose
                    name: PC Rafael
                    layout: horizontal
                  - type: custom:mushroom-entity-card
                    entity: switch.schlafzimmer_tv_steckdose
                    name: Schlafzimmer TV
                  - type: custom:mushroom-entity-card
                    entity: switch.steckdose_avr
                    name: Balkon Musik
                  - type: custom:mushroom-entity-card
                    entity: switch.steckdose_bkk
                    name: BKK
                  - type: custom:mushroom-entity-card
                    entity: switch.steckdose_kinderzimmer
                    name: Kinderzimmer
              - type: grid
                title: Rollos
                square: false
                columns: 2
                cards:
                  - type: custom:mushroom-cover-card
                    entity: cover.arbeitszimmer_rollo
                    layout: horizontal
                    name: Arbeitszimmer
                  - type: custom:mushroom-cover-card
                    entity: cover.schlafzimmer_rollo
                    layout: horizontal
                    name: Schlafzimmer
                  - type: custom:mushroom-cover-card
                    entity: cover.badezimmer_rollo
                    layout: horizontal
                    name: Badezimmer
                  - type: custom:mushroom-cover-card
                    entity: cover.kinderzimmer_rollo
                    layout: horizontal
                    name: Kinderzimmer
                  - type: custom:mushroom-cover-card
                    entity: cover.rollo_balkon
                    layout: horizontal
                    name: Balkon
                  - type: custom:mushroom-cover-card
                    entity: cover.rollo_kueche
                    layout: horizontal
                    name: K√ºche
                  - type: custom:mushroom-cover-card
                    entity: cover.wohnzimmer_rollo
                    layout: horizontal
                    name: Wohnzimmer
      - type: custom:gap-card
        view_layout:
          grid:area: right
  - theme: Backend-selected
    title: Adaptive Lighting
    path: adaptive-lighting
    type: custom:masonry-layout
    layout:
      width: 400
      max_cols: 4
    icon: ''
    badges: []
    cards:
      - type: markdown
        content: |
          ## üåÖ Adaptive Lighting System

          **Automatische Erkennung manueller Steuerung:**
          - `take_over_control`: Pausiert AL bei manuellen √Ñnderungen
          - `detect_non_ha_changes`: Erkennt √Ñnderungen via Siri, HomeKit, Schalter
          - `autoreset_control`: Gibt nach 1-2h automatisch wieder frei

          **Manual Control Status** zeigt, welche R√§ume gerade manuell gesteuert sind.
        title: ‚ÑπÔ∏è System-Info
      - type: entities
        entities:
          - entity: switch.adaptive_lighting_ankleide
          - entity: switch.adaptive_lighting_arbeitszimmer
          - entity: switch.adaptive_lighting_badezimmer
          - entity: switch.adaptive_lighting_balkon
          - entity: switch.adaptive_lighting_flur
          - entity: switch.adaptive_lighting_kinderzimmer
          - entity: switch.adaptive_lighting_kueche
          - entity: switch.adaptive_lighting_schlafzimmer
          - entity: switch.adaptive_lighting_waschzimmer
          - entity: switch.adaptive_lighting_wohnzimmer
        title: √úbergreifend
        state_color: true
      - type: entities
        entities:
          - entity: switch.adaptive_lighting_adapt_brightness_ankleide
          - entity: switch.adaptive_lighting_adapt_brightness_arbeitszimmer
          - entity: switch.adaptive_lighting_adapt_brightness_badezimmer
          - entity: switch.adaptive_lighting_adapt_brightness_balkon
          - entity: switch.adaptive_lighting_adapt_brightness_flur
          - entity: switch.adaptive_lighting_adapt_brightness_kinderzimmer
          - entity: switch.adaptive_lighting_adapt_brightness_kueche
          - entity: switch.adaptive_lighting_adapt_brightness_schlafzimmer
          - entity: switch.adaptive_lighting_adapt_brightness_waschzimmer
          - entity: switch.adaptive_lighting_adapt_brightness_wohnzimmer
        title: Helligkeit
        state_color: true
      - type: entities
        entities:
          - entity: switch.adaptive_lighting_adapt_color_ankleide
          - entity: switch.adaptive_lighting_adapt_color_arbeitszimmer
          - entity: switch.adaptive_lighting_adapt_color_badezimmer
          - entity: switch.adaptive_lighting_adapt_color_balkon
          - entity: switch.adaptive_lighting_adapt_color_flur
          - entity: switch.adaptive_lighting_adapt_color_kinderzimmer
          - entity: switch.adaptive_lighting_adapt_color_kueche
          - entity: switch.adaptive_lighting_adapt_color_schlafzimmer
          - entity: switch.adaptive_lighting_adapt_color_waschzimmer
          - entity: switch.adaptive_lighting_adapt_color_wohnzimmer
        title: Color
        state_color: true
      - type: entities
        entities:
          - entity: switch.adaptive_lighting_sleep_mode_ankleide
          - entity: switch.adaptive_lighting_sleep_mode_arbeitszimmer
          - entity: switch.adaptive_lighting_sleep_mode_badezimmer
          - entity: switch.adaptive_lighting_sleep_mode_balkon
          - entity: switch.adaptive_lighting_sleep_mode_flur
          - entity: switch.adaptive_lighting_sleep_mode_kinderzimmer
          - entity: switch.adaptive_lighting_sleep_mode_kueche
          - entity: switch.adaptive_lighting_sleep_mode_schlafzimmer
          - entity: switch.adaptive_lighting_sleep_mode_waschzimmer
          - entity: switch.adaptive_lighting_sleep_mode_wohnzimmer
        title: Sleep Mode
        state_color: true
      - type: entities
        entities:
          - entity: binary_sensor.ankleide_manual_control
          - entity: binary_sensor.arbeitszimmer_manual_control
          - entity: binary_sensor.badezimmer_manual_control
          - entity: binary_sensor.balkon_manual_control
          - entity: binary_sensor.flur_manual_control
          - entity: binary_sensor.kinderzimmer_manual_control
          - entity: binary_sensor.kueche_manual_control
          - entity: binary_sensor.schlafzimmer_manual_control
          - entity: binary_sensor.waschzimmer_manual_control
          - entity: binary_sensor.wohnzimmer_manual_control
        title: Manual Control
        state_color: true
  - theme: Backend-selected
    title: Battery
    path: battery
    type: custom:masonry-layout
    icon: ''
    badges: []
    cards:
      - type: custom:auto-entities
        card:
          show_header_toggle: false
          title: Battery low
          type: entities
        filter:
          include:
            - attributes:
                device_class: battery
              state: <= 100
          exclude:
            - name: /[Ll]ow/
            - name: /[Ss]tate/
        sort:
          method: state
          numeric: true
  - title: Robbi
    path: robbi
    type: sections
    sections:
      - type: grid
        cards:
          - type: custom:xiaomi-vacuum-map-card
            map_source:
              camera: camera.robbi_live_map
            calibration_source:
              camera: true
            entity: vacuum.robbi_2
            vacuum_platform: default
            grid_options:
              columns: full
              rows: auto
        column_span: 2
  - theme: Backend-selected
    title: All Lights
    path: test
    type: custom:masonry-layout
    layout:
      columns: 2
    badges: []
    cards:
      - type: custom:auto-entities
        card:
          type: entities
        filter:
          include:
            - domain: light
          exclude: []
        sort:
          method: friendly_name
          reverse: false
  - title: Sensoren
    path: sensoren
    cards:
      - type: custom:auto-entities
        card:
          type: entities
          title: Running Automations
          show_header_toggle: false
        filter:
          include:
            - domain: automation
              not:
                attributes:
                  current: 0
              options:
                type: custom:template-entity-row
                toggle: true
                secondary: >
                  {{relative_time(state_attr(config.entity,'last_triggered'))}} ago, {{state_attr(config.entity,'current') }} Running

                hold_action: |
                  {
                    "action": "navigate",
                    "navigation_path": "/config/automation/trace/{{state_attr(config.entity,'friendly_name')}}"
                  }
        sort:
          method: last_triggered
          reverse: true
      - type: custom:auto-entities
        card:
          type: entities
          title: Recent Automations
          show_header_toggle: false
        filter:
          include:
            - domain: automation
              state: 'on'
              last_triggered: <= 5
              options:
                type: custom:template-entity-row
                toggle: true
                secondary: >
                  {% if state_attr(config.entity,'last_triggered') %} {{relative_time(state_attr(config.entity,'last_triggered'))}} ago {% else %} Never triggered {% endif %}

                hold_action: |
                  {
                    "action": "navigate",
                    "navigation_path": "/config/automation/trace/{{state_attr(config.entity,'friendly_name')}}"
                  }
          exclude:
            - attributes:
                last_triggered: null
        sort:
          method: last_triggered
          reverse: true
      - type: custom:auto-entities
        card:
          type: entities
          title: Automations off
          show_header_toggle: false
        filter:
          include:
            - domain: automation
              state: 'off'
              options:
                secondary_info: last-triggered
          exclude:
            - attributes:
                last_triggered: null
        sort:
          method: last_triggered
          reverse: true
      - type: custom:auto-entities
        card:
          type: entities
          title: Automations off never triggered
          show_header_toggle: false
        filter:
          include:
            - domain: automation
              state: 'off'
              attributes:
                last_triggered: null
      - type: custom:auto-entities
        card:
          type: entities
          title: Automations on never triggered
          show_header_toggle: false
        filter:
          include:
            - domain: automation
              state: 'on'
              attributes:
                last_triggered: null
              options:
                type: custom:template-entity-row
                toggle: true
                secondary: >
                  {% if state_attr(config.entity,'last_triggered') %} {{relative_time(state_attr(config.entity,'last_triggered'))}} ago {% else %} Never triggered {% endif %}

                hold_action: |
                  {
                    "action": "navigate",
                    "navigation_path": "/config/automation/trace/{{state_attr(config.entity,'friendly_name')}}"
                  }
      - type: custom:auto-entities
        card:
          type: entities
          title: Last updated Sensors
        filter:
          include:
            - domain: sensor
              options:
                secondary_info: last-updated
        sort:
          method: last_updated
          numeric: true
          reverse: false
          count: 20
      - type: custom:auto-entities
        card:
          type: entities
          title: Sensor off never triggered
          show_header_toggle: false
        filter:
          include:
            - domain: sensor
              state: 'off'
              attributes:
                last_triggered: null
  - title: Temperatur
    path: temperatur
    cards:
      - type: custom:auto-entities
        card:
          type: entities
        filter:
          include:
            - device_manufacturer: Aqara
          exclude:
            - name: '*Aqara*'
            - name: '* Battery'
            - name: '* Atmospheric *'
            - name: '* Humidity *'
            - name: '* Humidity'
            - name: '* Identify'
            - name: '* Sensor'
            - name: '* Leak *'
            - name: '* Flurlicht'
            - name: '*Motion*'
            - name: '*Vibration*'
            - name: '*Kontakt*'
            - name: '*Rollo*'
            - name: '*Steckdose*'
            - name: '*Smart Essential*'
            - name: '*Stehlampe*'
            - name: '*Wasser*'
        sort:
          method: friendly_name
    type: panel
  - type: sections
    max_columns: 4
    title: Utility
    path: utlity
    sections:
      - type: grid
        cards:
          - type: vertical-stack
            cards:
              - type: custom:mushroom-chips-card
                alignment: center
                chips:
                  - type: template
                    entity: sensor.watchman_missing_entities
                    content: "{{ states('sensor.watchman_missing_entities') }} Issues"
                    icon: mdi:alert-circle
                    icon_color: >
                      {% set count = states('sensor.watchman_missing_entities') | int %} {% if count == 0 %} green {% elif count < 20 %} orange   {% else %} red {% endif %}

                    tap_action:
                      action: call-service
                      service: watchman.report
                  - type: template
                    entity: sensor.watchman_missing_services
                    content: "{{ states('sensor.watchman_missing_services') }} Services"
                    icon: mdi:tools
                    icon_color: >
                      {% if states('sensor.watchman_missing_services') | int > 0 %} orange {% else %} green {% endif %}

                  - type: template
                    content: >
                      {% set last = states('sensor.watchman_last_updated') %} {% if last != 'unknown' %}
                        {{ as_timestamp(last) | timestamp_custom('%H:%M') }}
                      {% else %}
                        Never
                      {% endif %}

                    icon: mdi:clock-check
                    tap_action:
                      action: call-service
                      service: watchman.report
                      data:
                        send_notification: true
                  - type: action
                    icon: mdi:refresh
                    tap_action:
                      action: call-service
                      service: watchman.report
                      confirmation:
                        text: Run Watchman check now?
              - type: conditional
                conditions:
                  - entity: sensor.watchman_missing_entities
                    state_not: '0'
                card:
                  type: custom:auto-entities
                  card:
                    type: entities
                    title: üî¥ Offline Devices
                    card_mod:
                      style: |
                        ha-card {
                          border: 2px solid var(--error-color);
                        }
                  filter:
                    include:
                      - state: unavailable
                        options:
                          secondary_info: last-changed
                      - state: unavail
                    exclude:
                      - entity_id: '*_blueprint*'
                      - domain: automation
                      - domain: script
                      - integration: blueprint
                  sort:
                    method: last_changed
                    reverse: true
                  show_empty: false
                  unique: true
              - type: custom:auto-entities
                card:
                  type: entities
                  title: üü° Unknown State
                  card_mod:
                    style: |
                      ha-card {
                        border: 1px solid var(--warning-color);
                      }
                filter:
                  include:
                    - state: unknown
                      options:
                        secondary_info: last-changed
                  exclude:
                    - entity_id: sensor.watchman_*
                    - entity_id: '*_blueprint*'
                    - domain: automation
                    - domain: script
                    - domain: scene
                    - attributes:
                        friendly_name: '*Blueprint*'
                sort:
                  method: name
                show_empty: false
                unique: true
              - type: custom:mushroom-template-card
                primary: Watchman Summary
                secondary: >
                  {% set entities = state_attr('sensor.watchman_missing_entities', 'entities') or [] %} {% set unavail = entities | selectattr('state', 'eq', 'unavail') | list | length %} {% set unknown = entities | selectattr('state', 'eq', 'unknown') | list | length %} {% set missing = entities | selectattr('state', 'eq', 'missing') | list | length %} üî¥ {{ unavail }} offline | üü° {{ unknown }} unknown | ‚ö™ {{ missing }} missing

                icon: mdi:shield-search
                icon_color: >
                  {% set count = states('sensor.watchman_missing_entities') | int %} {% if count == 0 %} green {% elif count < 20 %} orange {% else %} red {% endif %}

                badge_icon: |
                  {% if states('sensor.watchman_missing_entities') | int > 0 %}
                    mdi:alert
                  {% endif %}
                badge_color: red
                tap_action:
                  action: navigate
                  navigation_path: /config/logs
                hold_action:
                  action: more-info
                  entity: sensor.watchman_missing_entities
        columns: 2
  - theme: Backend-selected
    title: Settings
    path: settings
    type: custom:masonry-layout
    layout:
      width: 400
      max_cols: 4
    icon: mdi:cog
    badges: []
    cards:
      - type: entities
        title: Scene Management
        state_color: true
        entities:
          - entity: sensor.active_scenes
            name: Active Scenes
            icon: mdi:play-circle
          - entity: input_select.wakeup_routine_phase
          - type: divider
          - entity: binary_sensor.any_scene_active
          - entity: binary_sensor.scene_conflict_detected
          - entity: binary_sensor.motion_automations_disabled
          - type: divider
          - entity: input_boolean.movie
            name: 'Scene: Movie'
          - entity: input_boolean.party
            name: 'Scene: Party'
          - entity: input_boolean.kochen
            name: 'Scene: Kochen'
          - entity: input_boolean.essen
            name: 'Scene: Essen'
          - entity: input_boolean.baden
            name: 'Scene: Baden'
          - entity: input_boolean.sauna
            name: 'Scene: Sauna'
          - entity: input_boolean.arbeit
            name: 'Scene: Arbeit'
          - entity: input_boolean.gaming
            name: 'Scene: Gaming'
          - type: divider
          - entity: input_boolean.test_scene_film
          - entity: input_boolean.test_scene_party
          - entity: input_boolean.test_scene_kochen
          - entity: input_boolean.test_scene_baden
      - type: custom:auto-entities
        card:
          type: entities
          title: Climate Control
          state_color: true
        filter:
          include:
            - entity_id: input_number.ac_temp_*
        sort:
          method: friendly_name
      - type: custom:auto-entities
        card:
          type: entities
          title: Rollo Positions
          state_color: true
        filter:
          include:
            - entity_id: input_number.rollo_position_*
        sort:
          method: friendly_name
      - type: custom:auto-entities
        card:
          type: entities
          title: Fan Speeds
          state_color: true
        filter:
          include:
            - entity_id: input_number.fan_speed_*
        sort:
          method: friendly_name
      - type: custom:auto-entities
        card:
          type: entities
          title: Other Helpers
          state_color: true
        filter:
          include:
            - entity_id: input_boolean.gaming
            - entity_id: input_boolean.test_morning_routine
            - entity_id: input_boolean.haustur_besucher_inside
            - domain: input_datetime
            - domain: input_text
          exclude: []
        sort:
          method: friendly_name
