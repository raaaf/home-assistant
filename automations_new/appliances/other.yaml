# Appliances - Other.Yaml
# Generated by automation splitter - 1 automations
# Part of Home Assistant configuration

- id: '1692865865168'
  alias: "Benachrichtigung » Futterspender Wartung"
  description: "Überwacht Futterspender und erstellt Wartungsaufgaben bei Reinigungs- und Filterwechselbedarf mit HomePod-Ansagen"
  triggers:
  - trigger: state
    entity_id: sensor.mmgg_fi1_2081_cleantime
    to: '1'
    id: reinigung
  - trigger: state
    entity_id: sensor.mmgg_fi1_2081_desiccant_left_time
    to: '1'
    id: filter
  conditions:
  - alias: "Nicht öfter als alle 12 Stunden triggern"
    condition: template
    value_template: >-
      {% set last = state_attr('automation.notifications_futterspender', 'last_triggered') %}
      {{ last is none or (now() - last).total_seconds() > 43200 }}
  - alias: "Futterspender-Sensoren sind verfügbar"
    condition: template
    value_template: >-
      {{ states('sensor.mmgg_fi1_2081_cleantime') not in ['unknown', 'unavailable'] and
         states('sensor.mmgg_fi1_2081_desiccant_left_time') not in ['unknown', 'unavailable'] }}
  actions:
  - choose:
    - alias: "Filter ersetzen"
      conditions:
      - condition: trigger
        id: filter
      sequence:
      - action: notify.rafael
        data:
          title: "Futterspender — Filter ersetzen"
          message: "Bitte den Filter des Futterspenders ersetzen."
      - action: persistent_notification.create
        data:
          title: "Futterspender — Filter ersetzen"
          message: "Bitte den Filter des Futterspenders ersetzen."
          notification_id: futterspender_filter
    
    - alias: "Futterspender reinigen"
      conditions:
      - condition: trigger
        id: reinigung
      sequence:
      - action: notify.rafael
        data:
          title: "Futterspender — Reinigung erforderlich"
          message: "Bitte den Futterspender gründlich reinigen."
      - action: persistent_notification.create
        data:
          title: "Futterspender — Reinigung erforderlich"
          message: "Bitte eine gründliche Reinigung des Futterspenders durchführen."
          notification_id: futterspender_reinigung

    default:
    # Fallback bei unbekanntem Trigger - log only
    - action: logbook.log
      data:
        name: "Futterspender Fehler"
        message: "Unbekannter Wartungstrigger wurde ausgelöst"
        domain: automation
  mode: single
