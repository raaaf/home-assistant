# Appliances - Laundry.Yaml
# Generated by automation splitter - 4 automations
# Part of Home Assistant configuration

- id: '1661933181865'
  alias: "Benachrichtigung Â» Waschmaschine Status"
  description: "Ãœberwacht Waschmaschinen-Status via Stromverbrauch mit HomePod-Ansagen und Benachrichtigungen"
  triggers:
  - trigger: numeric_state
    entity_id: sensor.steckdose_waschmaschine_power
    above: 10
    for:
      seconds: 5
    id: arbeitet
  - trigger: numeric_state
    entity_id: sensor.steckdose_waschmaschine_power
    above: 1.1
    below: 7
    for:
      minutes: 5
    id: fertig
  - trigger: numeric_state
    entity_id: sensor.steckdose_waschmaschine_power
    below: 1
    for:
      minutes: 5
    id: aus
  conditions:
  - alias: "Stromverbrauchssensor ist verfÃ¼gbar"
    condition: template
    value_template: >-
      {{ states('sensor.steckdose_waschmaschine_power') not in ['unknown', 'unavailable'] }}
  actions:
  - choose:
    - alias: "Waschmaschine arbeitet"
      conditions:
      - condition: trigger
        id: arbeitet
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.waschmaschine
        data:
          option: "Arbeitet"
    
    - alias: "Waschmaschine ist fertig"
      conditions:
      - condition: trigger
        id: fertig
      - condition: state
        entity_id: input_select.waschmaschine
        state: "Arbeitet"
      sequence:
      # Status auf Fertig setzen
      - action: input_select.select_option
        target:
          entity_id: input_select.waschmaschine
        data:
          option: "Fertig"
      
      # Mobile Benachrichtigungen + Persistent Notification
      - parallel:
          # Mobile Benachrichtigungen (kritisch - funktioniert Ã¼berall)
          - action: notify.rafael
            data:
              title: "Waschmaschine ist fertig"
              message: "Fertig um {{ now().strftime('%H:%M Uhr') }}"
              data:
                push:
                  interruption-level: critical
          
          - action: notify.alex
            data:
              title: "Waschmaschine ist fertig"
              message: "Fertig um {{ now().strftime('%H:%M Uhr') }}"
              data:
                push:
                  interruption-level: critical
          
          # Email notification
          - action: notify.rafael_mail
            data:
              title: "Waschmaschine ist fertig"
              message: |
                Waschmaschine ist fertig

                Fertigstellung: {{ now().strftime('%H:%M Uhr') }}

                Die Waschmaschine hat ihren Waschgang beendet. Bitte hÃ¤nge die WÃ¤sche auf, wenn es dir mÃ¶glich ist.
    
    - alias: "Waschmaschine aus"
      conditions:
      - condition: trigger
        id: aus
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.waschmaschine
        data:
          option: "Aus"
      
      # Persistent notification entfernen wenn vorhanden
      - action: persistent_notification.dismiss
        data:
          notification_id: "waschmaschine_fertig"
    
    default:
    # Fallback: nur Log-Eintrag statt Benachrichtigung
    - action: logbook.log
      data:
        name: "Waschmaschine"
        message: "Unerwarteter Trigger: {{ trigger.id | default('unknown') }} ({{ now().strftime('%H:%M Uhr') }})"
- id: '1661934852025'
  alias: "Benachrichtigung Â» Trockner Status"
  description: "Ãœberwacht Trockner-Status via Stromverbrauch mit HomePod-Ansagen und Benachrichtigungen"
  triggers:
  - trigger: numeric_state
    entity_id: sensor.trockner_current_consumption
    above: 10
    for:
      seconds: 30
    id: arbeitet
  - trigger: numeric_state
    entity_id: sensor.trockner_current_consumption
    below: 60
    for:
      minutes: 2
    id: fertig
  - trigger: numeric_state
    entity_id: sensor.trockner_current_consumption
    below: 1.2
    for:
      minutes: 5
    id: aus
  conditions:
  - alias: "Stromverbrauchssensor ist verfÃ¼gbar"
    condition: template
    value_template: >-
      {{ states('sensor.trockner_current_consumption') not in ['unknown', 'unavailable'] }}
  actions:
  - choose:
    - alias: "Trockner arbeitet"
      conditions:
      - condition: trigger
        id: arbeitet
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.trockner
        data:
          option: "Arbeitet"
    
    - alias: "Trockner ist fertig"
      conditions:
      - condition: trigger
        id: fertig
      - condition: state
        entity_id: input_select.trockner
        state: "Arbeitet"
      sequence:
      # Status auf Fertig setzen
      - action: input_select.select_option
        target:
          entity_id: input_select.trockner
        data:
          option: "Fertig"
      
      # Mobile Benachrichtigungen + Persistent Notification
      - parallel:
          # Mobile Benachrichtigungen (kritisch - funktioniert Ã¼berall)
          - action: notify.rafael
            data:
              title: "ðŸ§º Trockner ist fertig"
              message: "Der Trockner ist fertig! ({{ now().strftime('%H:%M Uhr') }})"
              data:
                push:
                  interruption-level: critical
          
          - action: notify.alex
            data:
              title: "ðŸ§º Trockner ist fertig"
              message: "Der Trockner ist fertig! ({{ now().strftime('%H:%M Uhr') }})"
              data:
                push:
                  interruption-level: critical
          
          # Email notification
          - action: notify.rafael_mail
            data:
              title: "ðŸ§º Trockner ist fertig"
              message: >
                <html>
                <body>
                <h2>ðŸ§º Trockner ist fertig</h2>
                <p><strong>Fertigstellung:</strong> {{ now().strftime('%H:%M Uhr') }}</p>
                <p>Der Trockner hat seinen Trockengang beendet. Bitte hole die WÃ¤sche raus, wenn es dir mÃ¶glich ist.</p>
                </body>
                </html>

    - alias: "Fertig-Trigger ignorieren (auÃŸer Reihenfolge)"
      conditions:
      - condition: trigger
        id: fertig
      - condition: not
        conditions:
        - condition: state
          entity_id: input_select.trockner
          state: "Arbeitet"
      sequence:
      - action: logbook.log
        data:
          name: "Trockner"
          message: "Fertig-Trigger ignoriert, da Zustand nicht 'Arbeitet' ({{ now().strftime('%H:%M Uhr') }})"

    - alias: "Trockner aus"
      conditions:
      - condition: trigger
        id: aus
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.trockner
        data:
          option: "Aus"
      
      # Persistent notification entfernen wenn vorhanden
      - action: persistent_notification.dismiss
        data:
          notification_id: "trockner_fertig"
    
    default:
    # Fallback: nur Log-Eintrag statt Benachrichtigung
    - action: logbook.log
      data:
        name: "Trockner"
        message: "Unerwarteter Trigger: {{ trigger.id | default('unknown') }} ({{ now().strftime('%H:%M Uhr') }})"
  mode: single
  max_exceeded: silent
- id: '1682954529440'
  alias: Helper Â» Waschmaschine ist fertig
  description: Verwaltet Status-Flags und Stromversorgung der Waschmaschine
  triggers:
  - entity_id:
    - input_select.waschmaschine
    from: Arbeitet
    to: Fertig
    for:
      hours: 0
      minutes: 1
      seconds: 30
    id: fertig
    trigger: state
  - entity_id:
    - input_select.waschmaschine
    from: Fertig
    to: Aus
    for:
      hours: 0
      minutes: 0
      seconds: 30
    id: aus
    trigger: state
  - entity_id:
    - input_select.waschmaschine
    to: Aus
    for:
      hours: 0
      minutes: 30
      seconds: 0
    id: ausschalten
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: fertig
      sequence:
      - data: {}
        target:
          entity_id: input_boolean.waschmaschine_ist_fertig
        action: input_boolean.turn_on
    - conditions:
      - condition: trigger
        id: aus
      sequence:
      - data: {}
        target:
          entity_id: input_boolean.waschmaschine_ist_fertig
        action: input_boolean.turn_off
    - conditions:
      - condition: trigger
        id:
        - ausschalten
      sequence:
      - action: switch.turn_off
        target:
          entity_id: switch.steckdose_waschmaschine
  mode: single
- id: '1682954554027'
  alias: Helper Â» Trockner ist fertig
  description: Verwaltet Status-Flags und Stromversorgung des Trockners
  triggers:
  - entity_id: input_select.trockner
    from: Arbeitet
    to: Fertig
    for:
      seconds: 30
    id: fertig
    trigger: state
  - entity_id: input_select.trockner
    from: Fertig
    to: Aus
    for:
      seconds: 30
    id: aus
    trigger: state
  - entity_id: input_select.trockner
    to: Aus
    for:
      minutes: 30
    id: ausschalten
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: fertig
      sequence:
      - target:
          entity_id: input_boolean.trockner_ist_fertig
        action: input_boolean.turn_on
    - conditions:
      - condition: trigger
        id: aus
      sequence:
      - target:
          entity_id: input_boolean.trockner_ist_fertig
        action: input_boolean.turn_off
    - conditions:
      - condition: trigger
        id: ausschalten
      sequence:
      - target:
          entity_id: switch.trockner
        action: switch.turn_off
  mode: single
  max_exceeded: silent
