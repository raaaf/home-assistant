# Appliances - Laundry.Yaml
# Generated by automation splitter - 4 automations
# Part of Home Assistant configuration

- id: '1661933181865'
  alias: "Benachrichtigung ¬ª Waschmaschine Status"
  description: "√úberwacht Waschmaschinen-Status via Stromverbrauch mit HomePod-Ansagen und Benachrichtigungen"
  triggers:
  - trigger: numeric_state
    entity_id: sensor.steckdose_waschmaschine_power
    above: 10
    for:
      seconds: 5
    id: arbeitet
  - trigger: numeric_state
    entity_id: sensor.steckdose_waschmaschine_power
    above: 1.1
    below: 7
    for:
      minutes: 5
    id: fertig
  - trigger: numeric_state
    entity_id: sensor.steckdose_waschmaschine_power
    below: 1
    for:
      minutes: 5
    id: aus
  conditions:
  - alias: "Stromverbrauchssensor ist verf√ºgbar"
    condition: template
    value_template: >-
      {{ states('sensor.steckdose_waschmaschine_power') not in ['unknown', 'unavailable'] }}
  actions:
  - choose:
    - alias: "Waschmaschine arbeitet"
      conditions:
      - condition: trigger
        id: arbeitet
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.waschmaschine
        data:
          option: "Arbeitet"
    
    - alias: "Waschmaschine ist fertig"
      conditions:
      - condition: trigger
        id: fertig
      - condition: state
        entity_id: input_select.waschmaschine
        state: "Arbeitet"
      sequence:
      # Status auf Fertig setzen
      - action: input_select.select_option
        target:
          entity_id: input_select.waschmaschine
        data:
          option: "Fertig"
      
      # Parallel: HomePod Ansage + Mobile Benachrichtigungen + Persistent Notification
      - parallel:
          # HomePod Ansage (kritisch - immer au√üer Ruhezeiten)
          - action: script.hausgeraete_ansage
            data:
              message: "Die Waschmaschine ist fertig"
              priority: "kritisch"
          
          # Mobile Benachrichtigungen (nur wenn zuhause)
          - if:
              - condition: state
                entity_id: person.rafael
                state: home
            then:
              - action: notify.rafael
                data:
                  title: "üß∫ Waschmaschine ist fertig"
                  message: "Fertig um {{ now().strftime('%H:%M Uhr') }}"
                  data:
                    push:
                      interruption-level: critical
          
          - if:
              - condition: state
                entity_id: person.alex
                state: home
            then:
              - action: notify.alex
                data:
                  title: "üß∫ Waschmaschine ist fertig"
                  message: "Fertig um {{ now().strftime('%H:%M Uhr') }}"
                  data:
                    push:
                      interruption-level: critical
          
          # Persistent Notification als Fallback/Backup
          - action: persistent_notification.create
            data:
              notification_id: "waschmaschine_fertig"
              title: "üß∫ Waschmaschine ist fertig"
              message: "Die Waschmaschine wurde um {{ now().strftime('%H:%M Uhr') }} fertig"
    
    - alias: "Waschmaschine aus"
      conditions:
      - condition: trigger
        id: aus
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.waschmaschine
        data:
          option: "Aus"
      
      # Persistent notification entfernen wenn vorhanden
      - action: persistent_notification.dismiss
        data:
          notification_id: "waschmaschine_fertig"
    
    default:
    # Fallback bei unbekanntem Trigger
    - action: persistent_notification.create
      data:
        notification_id: "waschmaschine_error"
        title: "‚ö†Ô∏è Waschmaschine Fehler"
        message: "Unbekannter Status-Trigger bei {{ now().strftime('%H:%M Uhr') }}"
- id: '1661934852025'
  alias: "Benachrichtigung ¬ª Trockner Status"
  description: "√úberwacht Trockner-Status via Stromverbrauch mit HomePod-Ansagen und Benachrichtigungen"
  triggers:
  - trigger: numeric_state
    entity_id: sensor.trockner_current_consumption
    above: 10
    for:
      seconds: 30
    id: arbeitet
  - trigger: numeric_state
    entity_id: sensor.trockner_current_consumption
    above: 1.3
    below: 7
    for:
      minutes: 1
      seconds: 30
    id: fertig
  - trigger: numeric_state
    entity_id: sensor.trockner_current_consumption
    below: 1.2
    for:
      minutes: 5
    id: aus
  conditions:
  - alias: "Stromverbrauchssensor ist verf√ºgbar"
    condition: template
    value_template: >-
      {{ states('sensor.trockner_current_consumption') not in ['unknown', 'unavailable'] }}
  actions:
  - choose:
    - alias: "Trockner arbeitet"
      conditions:
      - condition: trigger
        id: arbeitet
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.trockner
        data:
          option: "Arbeitet"
    
    - alias: "Trockner ist fertig"
      conditions:
      - condition: trigger
        id: fertig
      - condition: state
        entity_id: input_select.trockner
        state: "Arbeitet"
      sequence:
      # Status auf Fertig setzen
      - action: input_select.select_option
        target:
          entity_id: input_select.trockner
        data:
          option: "Fertig"
      
      # Parallel: HomePod Ansage + Mobile Benachrichtigungen + Persistent Notification
      - parallel:
          # HomePod Ansage (kritisch - Arbeitszimmer da n√§her zur Waschk√ºche)
          - action: script.hausgeraete_ansage
            data:
              message: "Der Trockner ist fertig"
              priority: "kritisch"
          
          # Mobile Benachrichtigungen (nur wenn zuhause)
          - if:
              - condition: state
                entity_id: person.rafael
                state: home
            then:
              - action: notify.rafael
                data:
                  title: "üß∫ Trockner ist fertig"
                  message: "Der Trockner ist fertig! ({{ now().strftime('%H:%M Uhr') }})"
                  data:
                    push:
                      interruption-level: critical
          
          - if:
              - condition: state
                entity_id: person.alex
                state: home
            then:
              - action: notify.alex
                data:
                  title: "üß∫ Trockner ist fertig"
                  message: "Der Trockner ist fertig! ({{ now().strftime('%H:%M Uhr') }})"
                  data:
                    push:
                      interruption-level: critical
          
          # Persistent Notification als Fallback/Backup
          - action: persistent_notification.create
            data:
              notification_id: "trockner_fertig"
              title: "üß∫ Trockner ist fertig"
              message: "Der Trockner wurde um {{ now().strftime('%H:%M Uhr') }} fertig"
    
    - alias: "Trockner aus"
      conditions:
      - condition: trigger
        id: aus
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.trockner
        data:
          option: "Aus"
      
      # Persistent notification entfernen wenn vorhanden
      - action: persistent_notification.dismiss
        data:
          notification_id: "trockner_fertig"
    
    default:
    # Fallback bei unbekanntem Trigger
    - action: persistent_notification.create
      data:
        notification_id: "trockner_error"
        title: "‚ö†Ô∏è Trockner Fehler"
        message: "Unbekannter Status-Trigger bei {{ now().strftime('%H:%M Uhr') }}"
  mode: single
  max_exceeded: silent
- id: '1682954529440'
  alias: Helper ¬ª Waschmaschine ist fertig
  description: Verwaltet Status-Flags und Stromversorgung der Waschmaschine
  triggers:
  - entity_id:
    - input_select.waschmaschine
    from: Arbeitet
    to: Fertig
    for:
      hours: 0
      minutes: 1
      seconds: 30
    id: fertig
    trigger: state
  - entity_id:
    - input_select.waschmaschine
    from: Fertig
    to: Aus
    for:
      hours: 0
      minutes: 0
      seconds: 30
    id: aus
    trigger: state
  - entity_id:
    - input_select.waschmaschine
    to: Aus
    for:
      hours: 0
      minutes: 30
      seconds: 0
    id: ausschlaten
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: fertig
      sequence:
      - data: {}
        target:
          entity_id: input_boolean.waschmaschine_ist_fertig
        action: input_boolean.turn_on
    - conditions:
      - condition: trigger
        id: aus
      sequence:
      - data: {}
        target:
          entity_id: input_boolean.waschmaschine_ist_fertig
        action: input_boolean.turn_off
    - conditions:
      - condition: trigger
        id:
        - ausschlaten
      sequence:
      - action: switch.turn_off
        target:
          entity_id: switch.steckdose_waschmaschine
  mode: single
- id: '1682954554027'
  alias: Helper ¬ª Trockner ist fertig
  description: Verwaltet Status-Flags und Stromversorgung des Trockners
  triggers:
  - entity_id: input_select.trockner
    from: Arbeitet
    to: Fertig
    for:
      seconds: 30
    id: fertig
    trigger: state
  - entity_id: input_select.trockner
    from: Fertig
    to: Aus
    for:
      seconds: 30
    id: aus
    trigger: state
  - entity_id: input_select.trockner
    to: Aus
    for:
      minutes: 30
    id: ausschalten
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: fertig
      sequence:
      - target:
          entity_id: input_boolean.trockner_ist_fertig
        action: input_boolean.turn_on
    - conditions:
      - condition: trigger
        id: aus
      sequence:
      - target:
          entity_id: input_boolean.trockner_ist_fertig
        action: input_boolean.turn_off
    - conditions:
      - condition: trigger
        id: ausschalten
      sequence:
      - target:
          entity_id: switch.trockner
        action: switch.turn_off
  mode: single
  max_exceeded: silent
