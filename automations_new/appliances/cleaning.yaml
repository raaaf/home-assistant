# Appliances - Cleaning.Yaml
# Generated by automation splitter - 2 automations
# Part of Home Assistant configuration

- id: '1692862614295'
  alias: "Benachrichtigung ¬ª Robbi Wartung"
  description: "√úberwacht Staubsauger-Roboter und erstellt Wartungsaufgaben (Filter, B√ºrsten, Sensoren) mit TTS-Ansagen bei kritischen Werten"
  triggers:
  - trigger: numeric_state
    entity_id: sensor.s7_maxv_main_brush_time_left
    below: 20
    id: hauptbueste
  - trigger: numeric_state
    entity_id: sensor.s7_maxv_side_brush_time_left
    below: 20
    id: seitenbueste
  - trigger: numeric_state
    entity_id: sensor.s7_maxv_filter_time_left
    below: 20
    id: filter
  - trigger: numeric_state
    entity_id: sensor.s7_maxv_sensor_time_left
    below: 20
    id: sensoren
  conditions:
  - alias: "Nicht √∂fter als alle 12 Stunden triggern"
    condition: template
    value_template: >-
      {% set last = state_attr('automation.notifications_robbi', 'last_triggered') %}
      {{ last is none or (now() - last).total_seconds() > 43200 }}
  - alias: "Robbi ist verf√ºgbar (nicht unbekannt/unavailable)"
    condition: template
    value_template: >-
      {{ states('vacuum.s7_maxv') not in ['unknown', 'unavailable'] }}
  actions:
  - choose:
    - alias: "Hauptb√ºrste wechseln"
      conditions:
      - condition: trigger
        id: hauptbueste
      sequence:
      - parallel:
        # Email notification
        - action: notify.rafael_mail
          data:
            title: "Robbi Wartung - Hauptb√ºrste wechseln"
            message: |
              Robbi Wartung erforderlich

              Wartungsaufgabe: Hauptb√ºrste wechseln
              Verbleibende Zeit: {{
                states('sensor.s7_maxv_main_brush_time_left') | int(0)
              }} Stunden

              Bitte die Hauptb√ºrste von Robbi wechseln, wenn es dir m√∂glich ist.
    
    - alias: "Seitenb√ºrste wechseln"
      conditions:
      - condition: trigger
        id: seitenbueste
      sequence:
      - parallel:
        # Email notification
        - action: notify.rafael_mail
          data:
            title: "Robbi Wartung - Seitenb√ºrste wechseln"
            message: |
              Robbi Wartung erforderlich

              Wartungsaufgabe: Seitenb√ºrste wechseln
              Verbleibende Zeit: {{
                states('sensor.s7_maxv_side_brush_time_left') | int(0)
              }} Stunden

              Bitte die Seitenb√ºrste von Robbi wechseln, wenn es dir m√∂glich ist.
        # Mobile Benachrichtigung bei kritischem Wert (<5%)
    
    - alias: "Filter wechseln"
      conditions:
      - condition: trigger
        id: filter
      sequence:
      - parallel:
        # Email notification
        - action: notify.rafael_mail
          data:
            title: "Robbi Wartung - Filter wechseln"
            message: |
              Robbi Wartung erforderlich

              Wartungsaufgabe: Filter wechseln
              Verbleibende Zeit: {{
                states('sensor.s7_maxv_filter_time_left') | int(0)
              }} Stunden

              Bitte den Filter von Robbi wechseln, wenn es dir m√∂glich ist.

    - alias: "Sensoren reinigen"
      conditions:
      - condition: trigger
        id: sensoren
      sequence:
      - parallel:
        # Email notification
        - action: notify.rafael_mail
          data:
            title: "Robbi Wartung - Sensoren reinigen"
            message: |
              Robbi Wartung erforderlich

              Wartungsaufgabe: Sensoren reinigen
              Verbleibende Zeit: {{
                states('sensor.s7_maxv_sensor_time_left') | int(0)
              }} Stunden

              Bitte die Sensoren von Robbi reinigen, wenn es dir m√∂glich ist.
    default:
    # Fallback wenn unbekannter Trigger - log only
    - action: logbook.log
      data:
        name: "Robbi Automation Fehler"
        message: "Unbekannter Wartungstrigger wurde ausgel√∂st"
        domain: automation
  mode: single
- id: '1692862723924'
  alias: "Benachrichtigung ¬ª Luftreiniger Filter"
  description: "Erstellt Wartungsaufgabe wenn Luftreiniger-Filter unter 10% Lebensdauer mit TTS-Ansage bei kritischen Werten"
  triggers:
  - trigger: numeric_state
    entity_id: sensor.zhimi_vb4_bce4_filter_life_level
    below: 10
    id: filter_wartung
  conditions:
  - alias: "Nicht √∂fter als alle 12 Stunden triggern"
    condition: template
    value_template: >-
      {% set last = state_attr('automation.notification_luftreiniger', 'last_triggered') %}
      {{ last is none or (now() - last).total_seconds() > 43200 }}
  - alias: "Luftreiniger ist verf√ºgbar"
    condition: template
    value_template: >-
      {{ states('sensor.zhimi_vb4_bce4_filter_life_level') not in ['unknown', 'unavailable'] }}
  actions:
  - parallel:
      # Email notification
      - action: notify.rafael_mail
        data:
          title: "üå¨Ô∏è Luftreiniger Wartung - Filter wechseln"
          message: >
            <html>
            <body>
            <h2>üå¨Ô∏è Luftreiniger Wartung erforderlich</h2>
            <p><strong>Wartungsaufgabe:</strong> Filter wechseln</p>
            <p><strong>Verbleibende Lebensdauer:</strong> {{
              states('sensor.zhimi_vb4_bce4_filter_life_level') | int(0)
            }}%</p>
            <p>Bitte den Filter des Luftreinigers wechseln, wenn es dir m√∂glich ist.</p>
            </body>
            </html>
  mode: single
- id: '1736000000001'
  alias: "Benachrichtigung ¬ª Robbi Fehler"
  description: "Benachrichtigt wenn der Staubsauger einen Fehler hat oder stecken bleibt"
  triggers:
  - trigger: state
    entity_id: vacuum.s7_maxv
    to: error
    id: error
  - trigger: state
    entity_id: sensor.s7_maxv_status
    to: "stuck"
    id: stuck
  conditions:
  - condition: template
    value_template: "{{ states('vacuum.s7_maxv') not in ['unknown', 'unavailable'] }}"
  actions:
  - action: notify.family
    data:
      title: "Robbi braucht Hilfe"
      message: >
        {% if trigger.id == 'stuck' %}
        Robbi steckt fest und braucht Hilfe!
        {% else %}
        Robbi hat einen Fehler: {{ states('sensor.s7_maxv_status') | default('Unbekannt') }}
        {% endif %}
        Akku: {{ states('sensor.s7_maxv_battery') | default('?') }}%
      data:
        push:
          interruption-level: time-sensitive
  mode: single
