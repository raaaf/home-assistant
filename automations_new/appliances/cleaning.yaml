# Appliances - Cleaning.Yaml
# Generated by automation splitter - 2 automations
# Part of Home Assistant configuration

- id: '1692862614295'
  alias: "Benachrichtigung » Robbi Wartung"
  description: "Überwacht Staubsauger-Roboter und erstellt Wartungsaufgaben (Filter, Bürsten, Sensoren) mit TTS-Ansagen bei kritischen Werten"
  triggers:
  - trigger: numeric_state
    entity_id: sensor.s7_maxv_main_brush_time_left
    below: 20
    id: hauptbueste
  - trigger: numeric_state
    entity_id: sensor.s7_maxv_side_brush_time_left
    below: 20
    id: seitenbueste
  - trigger: numeric_state
    entity_id: sensor.s7_maxv_filter_time_left
    below: 20
    id: filter
  - trigger: numeric_state
    entity_id: sensor.s7_maxv_sensor_time_left
    below: 20
    id: sensoren
  conditions:
  - alias: "Nicht öfter als alle 12 Stunden triggern"
    condition: template
    value_template: >-
      {% set last = state_attr('automation.notifications_robbi', 'last_triggered') %}
      {{ last is none or (now() - last).total_seconds() > 43200 }}
  - alias: "Robbi ist verfügbar (nicht unbekannt/unavailable)"
    condition: template
    value_template: >-
      {{ states('vacuum.s7_maxv') not in ['unknown', 'unavailable'] }}
  actions:
  - choose:
    - alias: "Hauptbürste wechseln"
      conditions:
      - condition: trigger
        id: hauptbueste
      sequence:
      - action: notify.rafael
        data:
          title: "Robbi Wartung — Hauptbürste wechseln"
          message: "Verbleibend: {{ states('sensor.s7_maxv_main_brush_time_left') | int(0) }}h"
      - action: persistent_notification.create
        data:
          title: "Robbi Wartung — Hauptbürste wechseln"
          message: "Verbleibende Zeit: {{ states('sensor.s7_maxv_main_brush_time_left') | int(0) }} Stunden. Bitte die Hauptbürste von Robbi wechseln."
          notification_id: robbi_hauptbuerste
    
    - alias: "Seitenbürste wechseln"
      conditions:
      - condition: trigger
        id: seitenbueste
      sequence:
      - action: notify.rafael
        data:
          title: "Robbi Wartung — Seitenbürste wechseln"
          message: "Verbleibend: {{ states('sensor.s7_maxv_side_brush_time_left') | int(0) }}h"
      - action: persistent_notification.create
        data:
          title: "Robbi Wartung — Seitenbürste wechseln"
          message: "Verbleibende Zeit: {{ states('sensor.s7_maxv_side_brush_time_left') | int(0) }} Stunden. Bitte die Seitenbürste von Robbi wechseln."
          notification_id: robbi_seitenbuerste
    
    - alias: "Filter wechseln"
      conditions:
      - condition: trigger
        id: filter
      sequence:
      - action: notify.rafael
        data:
          title: "Robbi Wartung — Filter wechseln"
          message: "Verbleibend: {{ states('sensor.s7_maxv_filter_time_left') | int(0) }}h"
      - action: persistent_notification.create
        data:
          title: "Robbi Wartung — Filter wechseln"
          message: "Verbleibende Zeit: {{ states('sensor.s7_maxv_filter_time_left') | int(0) }} Stunden. Bitte den Filter von Robbi wechseln."
          notification_id: robbi_filter

    - alias: "Sensoren reinigen"
      conditions:
      - condition: trigger
        id: sensoren
      sequence:
      - action: notify.rafael
        data:
          title: "Robbi Wartung — Sensoren reinigen"
          message: "Verbleibend: {{ states('sensor.s7_maxv_sensor_time_left') | int(0) }}h"
      - action: persistent_notification.create
        data:
          title: "Robbi Wartung — Sensoren reinigen"
          message: "Verbleibende Zeit: {{ states('sensor.s7_maxv_sensor_time_left') | int(0) }} Stunden. Bitte die Sensoren von Robbi reinigen."
          notification_id: robbi_sensoren
    default:
    # Fallback wenn unbekannter Trigger - log only
    - action: logbook.log
      data:
        name: "Robbi Automation Fehler"
        message: "Unbekannter Wartungstrigger wurde ausgelöst"
        domain: automation
  mode: single
- id: '1692862723924'
  alias: "Benachrichtigung » Luftreiniger Filter"
  description: "Erstellt Wartungsaufgabe wenn Luftreiniger-Filter unter 10% Lebensdauer mit TTS-Ansage bei kritischen Werten"
  triggers:
  - trigger: numeric_state
    entity_id: sensor.zhimi_vb4_bce4_filter_life_level
    below: 10
    id: filter_wartung
  conditions:
  - alias: "Nicht öfter als alle 12 Stunden triggern"
    condition: template
    value_template: >-
      {% set last = state_attr('automation.notification_luftreiniger', 'last_triggered') %}
      {{ last is none or (now() - last).total_seconds() > 43200 }}
  - alias: "Luftreiniger ist verfügbar"
    condition: template
    value_template: >-
      {{ states('sensor.zhimi_vb4_bce4_filter_life_level') not in ['unknown', 'unavailable'] }}
  actions:
  - action: notify.rafael
    data:
      title: "Luftreiniger — Filter wechseln"
      message: "Verbleibende Lebensdauer: {{ states('sensor.zhimi_vb4_bce4_filter_life_level') | int(0) }}%"
  - action: persistent_notification.create
    data:
      title: "Luftreiniger — Filter wechseln"
      message: "Verbleibende Lebensdauer: {{ states('sensor.zhimi_vb4_bce4_filter_life_level') | int(0) }}%. Bitte den Filter des Luftreinigers wechseln."
      notification_id: luftreiniger_filter
  mode: single
- id: '1736000000001'
  alias: "Benachrichtigung » Robbi Fehler"
  description: "Benachrichtigt wenn der Staubsauger einen Fehler hat oder stecken bleibt"
  triggers:
  - trigger: state
    entity_id: vacuum.s7_maxv
    to: error
    id: error
  - trigger: state
    entity_id: sensor.s7_maxv_status
    to: "stuck"
    id: stuck
  conditions:
  - condition: template
    value_template: "{{ states('vacuum.s7_maxv') not in ['unknown', 'unavailable'] }}"
  actions:
  - action: notify.family
    data:
      title: "Robbi braucht Hilfe"
      message: >
        {% if trigger.id == 'stuck' %}
        Robbi steckt fest und braucht Hilfe!
        {% else %}
        Robbi hat einen Fehler: {{ states('sensor.s7_maxv_status') | default('Unbekannt') }}
        {% endif %}
        Akku: {{ states('sensor.s7_maxv_battery') | default('?') }}%
      data:
        push:
          interruption-level: time-sensitive
  mode: single
