# Appliances - Cleaning.Yaml
# Generated by automation splitter - 2 automations
# Part of Home Assistant configuration

- id: '1692862614295'
  alias: Notifications » Robbi
  description: Überwacht Staubsauger-Roboter und erstellt Aufgaben für Wartung (Filter,
    Bürsten, Sensoren)
  triggers:
  - trigger: template
    value_template: '{{ state_attr(''vacuum.robbi_2'', ''brush_cleaner.brush_life_level'')
      | int(100) < 10 }}

      '
    id: main-brush
  - trigger: template
    value_template: '{{ state_attr(''vacuum.robbi_2'', ''brush_life_level-10-2'')
      | int(100) < 10 }}

      '
    id: side-brush
  - trigger: template
    value_template: '{{ state_attr(''vacuum.robbi_2'', ''filter.filter_life_level'')
      | int(100) < 10 }}

      '
    id: filter
  - trigger: template
    value_template: "{{ state_attr('vacuum.robbi_2', 'props') is not none and \n \
      \  state_attr('vacuum.robbi_2', 'props').water_shortage_status | default(0)\
      \ == 1 }}\n"
    id: water-tank
  - trigger: template
    value_template: "{{ state_attr('vacuum.robbi_2', 'props') is not none and \n \
      \  state_attr('vacuum.robbi_2', 'props').sensor_dirty_time | int(9999) < 5000\
      \ }}\n"
    id: sensor
  conditions:
  - alias: Nicht öfter als alle 12 Stunden triggern
    condition: template
    value_template: '{% set last = state_attr(''automation.notifications_robbi'',
      ''last_triggered'') %} {{ last is none or (now() - last).total_seconds() > 12
      * 60 * 60 }}

      '
  - alias: Robbi ist verfügbar (nicht unbekannt/unavailable)
    condition: template
    value_template: '{{ states(''vacuum.robbi_2'') not in [''unknown'', ''unavailable'']
      }}

      '
  actions:
  - choose:
    - alias: Hauptbürste wechseln
      conditions:
      - condition: trigger
        id: main-brush
      sequence:
      - action: script.turn_on
        target:
          entity_id: script.xtodo_create_todo
        data:
          variables:
            todo: Robbi » Hauptbürste wechseln ({{ state_attr('vacuum.robbi_2', 'brush_cleaner.brush_life_level')
              | int(0) }}% verbleibend)
    - alias: Seitenbürste wechseln
      conditions:
      - condition: trigger
        id: side-brush
      sequence:
      - action: script.turn_on
        target:
          entity_id: script.xtodo_create_todo
        data:
          variables:
            todo: Robbi » Seitenbürste wechseln ({{ state_attr('vacuum.robbi_2', 'brush_life_level-10-2')
              | int(0) }}% verbleibend)
    - alias: Filter wechseln
      conditions:
      - condition: trigger
        id: filter
      sequence:
      - action: script.turn_on
        target:
          entity_id: script.xtodo_create_todo
        data:
          variables:
            todo: Robbi » Filter wechseln ({{ state_attr('vacuum.robbi_2', 'filter.filter_life_level')
              | int(0) }}% verbleibend)
    - alias: Wassertank auffüllen
      conditions:
      - condition: trigger
        id: water-tank
      sequence:
      - action: script.turn_on
        target:
          entity_id: script.xtodo_create_todo
        data:
          variables:
            todo: Robbi » Wassertank ist leer - auffüllen
    - alias: Sensoren reinigen
      conditions:
      - condition: trigger
        id: sensor
      sequence:
      - action: script.turn_on
        target:
          entity_id: script.xtodo_create_todo
        data:
          variables:
            todo: Robbi » Sensoren reinigen ({{ state_attr('vacuum.robbi_2', 'props').sensor_dirty_time
              | default('unbekannt') }} verbleibend)
  mode: single
- id: '1692862723924'
  alias: Notification » Luftreiniger
  description: Erstellt Aufgabe wenn Luftreiniger-Filter unter 10% Lebensdauer
  triggers:
  - trigger: numeric_state
    entity_id: sensor.zhimi_vb4_bce4_filter_life_level
    below: 10
  conditions:
  - condition: template
    value_template: " {% set last = state_attr('automation.notification_luftreiniger',\
      \ 'last_triggered') %}\n    {{ last is none or (now() - last).total_seconds()\
      \ > 12 * 60 * 60 }}"
  actions:
  - entity_id: script.xtodo_create_todo
    data:
      variables:
        todo: Luftreiniger benötigt neuen Filter
    action: script.turn_on
  mode: single
