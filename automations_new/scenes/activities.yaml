# Scenes - Activities.Yaml
# Generated by automation splitter - 3 automations
# Part of Home Assistant configuration

- id: '1722519061740'
  alias: Scenen » Gäste
  description: Deaktiviert bestimmte Automationen im Gästemodus für mehr Privatsphäre
  triggers:
  - entity_id: input_boolean.guest_or_away
    to: 'on'
    for:
      minutes: 1
    id: gäste-an
    trigger: state
  - entity_id: input_boolean.guest_or_away
    to: 'off'
    for:
      minutes: 1
    id: gäste-aus
    trigger: state
  - event_type: timer.finished
    event_data:
      entity_id: timer.lock_door_after_guest
    id: timer-abgelaufen
    trigger: event
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: gäste-an
      sequence:
      - action: automation.turn_off
        target:
          entity_id:
          - automation.helper_workday_musik  # Helper » Workday Musik - Automatic workday music
        data: {}
      - target:
          entity_id:
          - switch.wohnzimmer_steckdose
          - switch.kuchengerate
        action: switch.turn_on
    - conditions:
      - condition: trigger
        id: gäste-aus
      sequence:
      - target:
          entity_id:
          - automation.helper_workday_musik  # Helper » Workday Musik - Automatic workday music
        action: automation.turn_on
      - target:
          entity_id:
          - switch.wohnzimmer_steckdose
          - switch.kuchengerate
        action: switch.turn_off
    - conditions:
      - condition: trigger
        id: timer-abgelaufen
      - condition: state
        entity_id: lock.smart_lock_pro
        state: unlocked
      - condition: template
        value_template: "{{ has_value('lock.smart_lock_pro') }}"
      - condition: state
        entity_id: input_boolean.alle_sind_weg
        state: 'on'
      - condition: template
        value_template: "{{ has_value('input_boolean.alle_sind_weg') }}"
      sequence:
      - target:
          entity_id: lock.smart_lock_pro
        action: lock.lock
      - action: logbook.log
        data:
          name: Tür automatisch verschlossen
          message: Nach Ablauf des Timers automatisch verschlossen
          domain: automation
  mode: single
- id: '1737546608146'
  alias: Scenen » Party
  description: Aktiviert Party-Modus in allen Räumen mit dynamischer Beleuchtung und
    deaktivierten Bewegungsmeldern
  triggers:
  - entity_id:
    - input_boolean.party
    to: 'on'
    id: 'on'
    trigger: state
  - entity_id:
    - input_boolean.party
    to: 'off'
    id: 'off'
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - action: switch.turn_off
        target:
          entity_id:
          - switch.adaptive_lighting_wohnzimmer
          - switch.adaptive_lighting_kueche
          - switch.adaptive_lighting_badezimmer
          - switch.adaptive_lighting_kinderzimmer
          - switch.adaptive_lighting_arbeitszimmer
          - switch.adaptive_lighting_flur
          - switch.adaptive_lighting_schlafzimmer
          - switch.adaptive_lighting_waschzimmer
          - switch.adaptive_lighting_balkon
      - action: light.turn_off
        data:
          transition: 5
        target:
          entity_id:
          - light.wohnzimmer_wand_alle
          - light.kuche_decke_alle
          - light.flur_decke_alle
          - light.schlafzimmer_decke_alle
          - light.ankleide_decke_alle
      - action: automation.turn_off
        target:
          entity_id:
          - automation.motion_kuche_2  # Motion sensor automation (living room)
          - automation.motion_flur_wohnung  # Hallway motion sensor
          - automation.arbeitszimmer_motion  # Bedroom motion sensor
          - automation.motion_badezimmer_gross  # Kitchen motion sensor
          - automation.motion_esstisch  # Bathroom motion sensor
          - automation.arbeitszimmer_motion  # Office motion sensor
          - automation.kinderzimmer_motion  # Additional motion sensor
          - automation.motion_haustur  # Front door motion sensor
        data: {}
      - action: scene_presets.start_dynamic_scene
        data:
          preset_id: 9565033d-f2ea-4821-bfba-7dd9b35be20a
          targets:
            entity_id:
            - light.alle_wohnzimmer_lichter
            - light.alle_kuche_lichter
          transition: 45
          interval: 60
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - alias: "Re-enable living room adaptive lighting if party_wohnzimmer is off"
        choose:
        - conditions:
          - condition: state
            entity_id: input_boolean.party_wohnzimmer
            state: 'off'
          - condition: state
            entity_id: input_boolean.movie
            state: 'off'
          sequence:
          - action: switch.turn_on
            target:
              entity_id: switch.adaptive_lighting_wohnzimmer
      - alias: "Re-enable kitchen adaptive lighting if cooking/movie/party_wohnzimmer off"
        choose:
        - conditions:
          - condition: state
            entity_id: input_boolean.kochen
            state: 'off'
          - condition: state
            entity_id: input_boolean.movie
            state: 'off'
          - condition: state
            entity_id: input_boolean.party_wohnzimmer
            state: 'off'
          sequence:
          - action: switch.turn_on
            target:
              entity_id: switch.adaptive_lighting_kueche
      - alias: "Re-enable bathroom adaptive lighting if sauna/baden off"
        choose:
        - conditions:
          - condition: state
            entity_id: input_boolean.sauna
            state: 'off'
          - condition: state
            entity_id: input_boolean.baden
            state: 'off'
          sequence:
          - action: switch.turn_on
            target:
              entity_id: switch.adaptive_lighting_badezimmer
      - alias: "Re-enable other room adaptive lighting unconditionally"
        action: switch.turn_on
        target:
          entity_id:
          - switch.adaptive_lighting_kinderzimmer
          - switch.adaptive_lighting_arbeitszimmer
          - switch.adaptive_lighting_flur
          - switch.adaptive_lighting_schlafzimmer
          - switch.adaptive_lighting_waschzimmer
          - switch.adaptive_lighting_balkon
      - alias: "Re-enable all motion sensors only if no conflicting scenes are active"
        choose:
        - conditions:
          # Kitchen motion - check movie, cooking, party_wohnzimmer
          - condition: state
            entity_id: input_boolean.movie
            state: 'off'
          - condition: state
            entity_id: input_boolean.kochen
            state: 'off'
          - condition: state
            entity_id: input_boolean.party_wohnzimmer
            state: 'off'
          sequence:
          - action: automation.turn_on
            target:
              entity_id: automation.motion_kuche_2  # Motion sensor automation (kitchen)
      - alias: "Re-enable hallway motion if no conflicting scenes"
        choose:
        - conditions:
          - condition: state
            entity_id: input_boolean.movie
            state: 'off'
          - condition: state
            entity_id: input_boolean.party_wohnzimmer
            state: 'off'
          sequence:
          - action: automation.turn_on
            target:
              entity_id: automation.motion_flur_wohnung  # Hallway motion sensor
      - alias: "Re-enable bedroom motion if work mode is off"
        choose:
        - conditions:
          - condition: state
            entity_id: input_boolean.arbeit
            state: 'off'
          sequence:
          - action: automation.turn_on
            target:
              entity_id: automation.arbeitszimmer_motion  # Bedroom motion sensor
      - alias: "Re-enable other motion sensors unconditionally"
        action: automation.turn_on
        target:
          entity_id:
          - automation.motion_badezimmer_gross  # Bathroom motion sensor
          - automation.motion_esstisch  # Dining table motion sensor
          - automation.arbeitszimmer_motion  # Office motion sensor
          - automation.kinderzimmer_motion  # Additional motion sensor
          - automation.motion_haustur  # Front door motion sensor
      - action: light.turn_off
        data:
          transition: 5
        target:
          entity_id:
          - light.alle_wohnzimmer_lichter
          - light.alle_kuche_lichter
    default: []
  mode: restart
- id: '1744448757845'
  alias: Szene » Arbeit
  description: 'Aktiviert spezielle Lichtszene und deaktiviert Bewegung bei aktivem
    Arbeitsmodus. Berücksichtigt auch Schlafenszeit für Beleuchtung.

    '
  triggers:
  - trigger: state
    entity_id: input_boolean.arbeit
    to: 'on'
    id: arbeit-on
  - trigger: state
    entity_id: input_boolean.arbeit
    to: 'off'
    id: arbeit-off
  conditions:
  - condition: state
    entity_id: input_boolean.gaming
    state: 'off'
  actions:
  - choose:
    - alias: Arbeitsmodus aktivieren
      conditions:
      - condition: trigger
        id: arbeit-on
      sequence:
      - alias: Bewegungsmelder Schlafzimmer deaktivieren
        action: automation.turn_off
        target:
          entity_id: automation.arbeitszimmer_motion  # Bedroom motion sensor
        data: {}
      - choose:
        - alias: Nach 21 Uhr - nur Nachtlichter (unabhängig von Helligkeit)
          conditions:
          - condition: template
            value_template: '{{ now().hour >= 21 }}'
          sequence:
          - alias: Nachtlichter einschalten
            action: light.turn_on
            target:
              entity_id: light.alle_arbeitszimmer_nachtlichter
            data:
              transition: 2
        - alias: Sehr hell draußen - keine Lichter nötig
          conditions:
          - condition: numeric_state
            entity_id: sensor.sunlight_pct
            above: 70
          sequence: []
        - alias: Hell draußen - nur Nachtlichter
          conditions:
          - condition: numeric_state
            entity_id: sensor.sunlight_pct
            above: 40
            below: 71
          sequence:
          - alias: Nachtlichter einschalten
            action: light.turn_on
            target:
              entity_id: light.alle_arbeitszimmer_nachtlichter
            data:
              transition: 2
        default:
        - alias: Dunkel oder moderat - alle Arbeitslichter einschalten
          action: light.turn_on
          target:
            entity_id:
            - light.alle_arbeitszimmer_nachtlichter
            - light.alle_arbeitszimmer_lichter
          data:
            transition: 2
    - alias: Arbeitsmodus deaktivieren
      conditions:
      - condition: trigger
        id: arbeit-off
      sequence:
      - alias: "Re-enable bedroom motion only if party and gaming modes are off"
        choose:
        - conditions:
          - condition: state
            entity_id: input_boolean.party
            state: 'off'
          - condition: state
            entity_id: input_boolean.gaming
            state: 'off'
          sequence:
          - alias: Bewegungsmelder Schlafzimmer aktivieren
            action: automation.turn_on
            target:
              entity_id: automation.arbeitszimmer_motion  # Bedroom motion sensor
            data: {}
      - alias: Nur ausschalten wenn es dunkel ist
        condition: template
        value_template: "{{ has_value('sun.sun') and (state_attr('sun.sun', 'elevation') < 0 or \n   (has_value('input_boolean.schlafenszeit') and is_state('input_boolean.schlafenszeit',\
          \ 'on'))) }}\n"
      - alias: Alle Arbeitslichter ausschalten
        action: light.turn_off
        target:
          entity_id:
          - light.alle_arbeitszimmer_nachtlichter
          - light.alle_arbeitszimmer_lichter
        data: {}
  mode: restart
