# Areas - Flur.Yaml
# Generated by automation splitter - 5 automations
# Part of Home Assistant configuration

- id: '1652698714339'
  alias: Flur » Luftreiniger
  description: 'Steuert den Luftreiniger basierend auf PM2.5-Werten (Aus < 10, Ein
    > 20 für je 1 Minute). Verhindert unnötige Schaltzyklen durch Hysterese.

    '
  triggers:
  - trigger: numeric_state
    entity_id: sensor.zhimi_vb4_bce4_pm25_density
    below: 10
    for:
      minutes: 1
    id: excellent
  - trigger: numeric_state
    entity_id: sensor.zhimi_vb4_bce4_pm25_density
    above: 20
    for:
      minutes: 1
    id: poor
  conditions: []
  actions:
  - choose:
    - alias: Luftqualität exzellent - Luftreiniger ausschalten
      conditions:
      - condition: trigger
        id: excellent
      - alias: Luftreiniger läuft gerade
        condition: state
        entity_id: fan.zhimi_vb4_bce4_air_purifier
        state: 'on'
      - alias: Sensor ist verfügbar
        condition: template
        value_template: '{{ states(''sensor.zhimi_vb4_bce4_pm25_density'') not in
          [''unknown'', ''unavailable''] }}

          '
      sequence:
      - alias: Luftreiniger ausschalten
        action: fan.turn_off
        target:
          entity_id: fan.zhimi_vb4_bce4_air_purifier
    - alias: Luftqualität schlecht - Luftreiniger einschalten
      conditions:
      - condition: trigger
        id: poor
      - alias: Luftreiniger läuft nicht
        condition: state
        entity_id: fan.zhimi_vb4_bce4_air_purifier
        state: 'off'
      - alias: Sensor ist verfügbar
        condition: template
        value_template: '{{ states(''sensor.zhimi_vb4_bce4_pm25_density'') not in
          [''unknown'', ''unavailable''] }}

          '
      sequence:
      - alias: Luftreiniger einschalten
        action: fan.turn_on
        target:
          entity_id: fan.zhimi_vb4_bce4_air_purifier
      - alias: Auto-Modus aktivieren
        action: fan.set_preset_mode
        target:
          entity_id: fan.zhimi_vb4_bce4_air_purifier
        data:
          preset_mode: Auto
  mode: single
- id: '1672931147408'
  alias: Motion » Flur Wohnung
  description: Bewegungsgesteuerte Beleuchtung im Flur mit Nachtlicht-Modus
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.flur_motion
      light_switch:
        entity_id: light.alle_flur_lichter
      include_night_lights: night_lights_enabled
      night_lights:
        entity_id:
        - light.alle_flur_nachtlichter
      night_lights_after_time: '22:00:00'
      night_lights_before_time: 06:00:00
      night_time_delay: 0
      time_delay: 1
      include_ambient: ambient_enabled
      ambient_light_sensor: sensor.balkon_motion_illuminance
      night_lights_conditions:
      - time_enabled
      ambient_light_options: ambient_light_option_disabled
- id: '1696841069890'
  alias: Flur » Robbi
  description: Steuert Staubsauger-Roboter mit verschiedenen Reinigungsplänen und
    Sonderreinigungen
  triggers:
  - trigger: time
    at: 06:00:00
    id: reset
  - trigger: time
    at: 08:30:00
    id: esstisch
  - trigger: time
    at: 08:30:00
    id: regular
  - trigger: state
    entity_id: input_boolean.alle_sind_weg
    to: 'on'
    for: 00:05:00
    id: alles
  - trigger: state
    entity_id: vacuum.robbi_2
    to: returning
    id: empty
  conditions: []
  actions:
  - choose:
    - alias: Täglicher Reset um 6:00 Uhr
      conditions:
      - condition: trigger
        id: reset
      sequence:
      - alias: 'Reset: Robbi lief heute bereits'
        action: input_boolean.turn_off
        target:
          entity_id: input_boolean.robbi_lief_heute_bereits
      - alias: 'Reset: Küche erledigt'
        action: input_boolean.turn_off
        target:
          entity_id: input_boolean.robbi_kitchen_done
      - alias: Saugkraft auf Basic setzen
        action: vacuum.set_fan_speed
        target:
          entity_id: vacuum.robbi_2
        data:
          fan_speed: Basic
    - alias: Esstisch-Reinigung (Di, Do 8:30)
      conditions:
      - condition: trigger
        id: esstisch
      - condition: time
        weekday:
        - tue
        - thu
      sequence:
      - alias: Saugkraft für Esstisch
        action: vacuum.set_fan_speed
        target:
          entity_id: vacuum.robbi_2
        data:
          fan_speed: Basic
      - alias: Esstisch-Segment reinigen
        action: button.press
        target:
          entity_id: button.roborock_a27_737e_segment_21
    - alias: Vollreinigung wenn alle weg sind
      conditions:
      - condition: trigger
        id: alles
      - alias: Robbi lief heute noch nicht
        condition: state
        entity_id: input_boolean.robbi_lief_heute_bereits
        state: 'off'
      - alias: Robbi ist verfügbar
        condition: template
        value_template: '{{ states(''vacuum.robbi_2'') not in [''unknown'', ''unavailable'',
          ''cleaning'', ''returning''] }}

          '
      sequence:
      - alias: Vollgas für komplette Reinigung
        action: vacuum.set_fan_speed
        target:
          entity_id: vacuum.robbi_2
        data:
          fan_speed: Full Speed
      - alias: Vollreinigung starten
        action: vacuum.start
        target:
          entity_id: vacuum.robbi_2
      - alias: Merken dass Robbi heute schon lief
        action: input_boolean.turn_on
        target:
          entity_id: input_boolean.robbi_lief_heute_bereits
    - alias: Reguläre Reinigung (Mo, Mi, Fr 8:30)
      conditions:
      - condition: trigger
        id: regular
      - condition: time
        weekday:
        - mon
        - wed
        - fri
      - alias: Robbi lief heute noch nicht
        condition: state
        entity_id: input_boolean.robbi_lief_heute_bereits
        state: 'off'
      - alias: Robbi ist verfügbar
        condition: template
        value_template: '{{ states(''vacuum.robbi_2'') not in [''unknown'', ''unavailable'',
          ''cleaning'', ''returning''] }}

          '
      sequence:
      - alias: Normale Saugkraft für reguläre Reinigung
        action: vacuum.set_fan_speed
        target:
          entity_id: vacuum.robbi_2
        data:
          fan_speed: Basic
      - alias: Reguläre Reinigung starten
        action: vacuum.start
        target:
          entity_id: vacuum.robbi_2
      - alias: Merken dass Robbi heute schon lief
        action: input_boolean.turn_on
        target:
          entity_id: input_boolean.robbi_lief_heute_bereits
    - alias: Küche nachsaugen nach Hauptreinigung
      conditions:
      - condition: trigger
        id: empty
      - alias: Jemand ist zu Hause
        condition: state
        entity_id: input_boolean.alle_sind_weg
        state: 'off'
      - alias: Küche noch nicht erledigt
        condition: state
        entity_id: input_boolean.robbi_kitchen_done
        state: 'off'
      - alias: Hauptreinigung war heute schon
        condition: state
        entity_id: input_boolean.robbi_lief_heute_bereits
        state: 'on'
      - alias: Reinigung dauerte mindestens 15 Minuten
        condition: template
        value_template: '{{ states(''sensor.roborock_a27_737e_props_clean_time'')
          | int(0) >= 15 }}

          '
      - alias: Zwischen 8 und 20 Uhr
        condition: time
        after: 08:00:00
        before: '20:00:00'
      - alias: Robbi ist verfügbar für Küche
        condition: template
        value_template: '{{ states(''vacuum.robbi_2'') not in [''unknown'', ''unavailable'',
          ''cleaning''] }}

          '
      sequence:
      - alias: Küchen-Reinigungsscript ausführen
        action: script.robbi_go_to_kitchen
      - alias: Küche als erledigt markieren
        action: input_boolean.turn_on
        target:
          entity_id: input_boolean.robbi_kitchen_done
  mode: single
- id: '1745826967324'
  alias: Motion » Haustür
  description: Bewegungsgesteuerte Beleuchtung im Flur mit Nachtlicht-Modus
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.haustur_motion_occupancy
      light_switch:
        entity_id:
        - light.flur_decke_2
        - light.flur_decke_6
      include_night_lights: night_lights_enabled
      night_lights:
        entity_id:
        - light.stahltraeger
        - light.alle_flur_nachtlichter
      night_lights_after_time: '22:00:00'
      night_lights_before_time: 06:00:00
      night_time_delay: 0
      time_delay: 1
      include_ambient: ambient_disabled
      ambient_light_sensor: sensor.balkon_motion_illuminance
      night_lights_conditions:
      - time_enabled
      night_lights_entity_state:
      - input_boolean.schlafenszeit
      night_light_brightness: 10
      ambient_light_value: 40
      ambient_light_high_value: 80
      ambient_light_options: ambient_light_option_enabled
      include_light_control:
      - use_brightness
- id: '1746390065079'
  alias: Color Loop » Flur
  description: 'Farbwechsel-Animation für Flur Lichter'
  use_blueprint:
    path: mdolnik/color_loop.yaml
    input:
      light:
      - light.alle_flur_nachtlichter
      helper_toggle: input_boolean.es_ist_dunkel
      color_1:
      - 255
      - 38
      - 0
      color_2:
      - 4
      - 51
      - 255
      max_color_distance: 120
