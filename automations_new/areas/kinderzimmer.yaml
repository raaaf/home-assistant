# Areas - Kinderzimmer.Yaml
# Generated by automation splitter - 4 automations
# Part of Home Assistant configuration

- id: '1692710690350'
  alias: Motion » Kinderzimmer
  description: Bewegungsgesteuerte Beleuchtung im Kinderzimmer mit Nachtlicht-Modus
    und Helligkeitssensor
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.kinderzimmer_motion_presence
      light_switch:
        entity_id: light.alle_kinderzimmer_lichter
      include_ambient: ambient_enabled
      ambient_light_sensor: sensor.balkon_motion_illuminance_safe
      include_night_lights: night_lights_enabled
      night_lights:
        entity_id: light.alle_kinderzimmer_nachtlichter
      include_night_light_control:
      - use_night_brightness
      - use_brightness
      night_lights_after_time: '19:00:00'
      night_lights_before_time: 05:30:00
      time_delay: 0
      night_time_delay: 0
      night_lights_conditions:
      - entity_state_enabled
      night_lights_entity_state:
      - input_boolean.schlafenszeit
      include_sun: sun_disabled
      night_light_brightness: 5
      ambient_light_value: 150
      ambient_light_high_value: 200
      include_device_tracker: zone_enabled
      zone: zone.home
- id: '1722519561150'
  alias: Helper » Dynamische Kinder-Schlafzeiten
  description: 'Berechnet täglich optimale Schlafzeiten für Kinder basierend auf:
    - Jahreszeit und Monat - Sonnenuntergang - Wetter und Helligkeit - Temperatur

    '
  trigger:
  - at: 00:10:00
    trigger: time
  conditions: []
  actions:
  - variables:
      basis_einschlaf_schultag: '19:30:00'
      basis_einschlaf_wochenende: '20:30:00'
      basis_aufwach_schultag: 06:30:00
      basis_aufwach_wochenende: 07:30:00
      aktueller_monat: '{{ now().month | int }}'
      aussentemperatur: '{% if has_value(''weather.fuerth_bayern'') %}{{ state_attr(''weather.fuerth_bayern'', ''temperature'')
        | float(20) }}{% else %}20{% endif %}'
      helligkeit_draussen: '{% if has_value(''sensor.balkon_motion_illuminance'') %}{{ states(''sensor.balkon_motion_illuminance'') | float(100)
        }}{% else %}100{% endif %}'
      wetter: '{% if has_value(''weather.fuerth_bayern'') %}{{ states(''weather.fuerth_bayern'') }}{% else %}sunny{% endif %}'
      sonnenuntergang_zeit: "{% set su = state_attr('sun.sun', 'next_setting') %}\
        \ {% if su %}\n  {{ (su | as_datetime | as_local).strftime('%H:%M') }}\n{%\
        \ else %}\n  20:00\n{% endif %}\n"
      helligkeit_offset: "{{ 0 }}"
      saison_offset_einschlaf: "{{ 0 }}"
      saison_offset_aufwach: "{{ 0 }}"
      sonnenuntergang_offset: "{{ 0 }}"
      wetter_offset: "{{ 0 }}"
      temp_offset: "{{ 0 }}"
      gesamt_offset_einschlaf_schultag: '{{ 0 }}'
      gesamt_offset_einschlaf_wochenende: '{{ 0 }}'
      gesamt_offset_aufwach: '{{ 0 }}'
      einschlaf_schultag_final: '{{ basis_einschlaf_schultag }}'
      einschlaf_wochenende_final: '{{ basis_einschlaf_wochenende }}'
      aufwach_schultag_final: '{{ basis_aufwach_schultag }}'
      aufwach_wochenende_final: '{{ basis_aufwach_wochenende }}'
  - action: input_datetime.set_datetime
    target:
      entity_id: input_datetime.einschlafzeit_arbeitstag
    data:
      time: '{{ einschlaf_schultag_final }}'
  - action: input_datetime.set_datetime
    target:
      entity_id: input_datetime.einschlafzeit_freier_tag
    data:
      time: '{{ einschlaf_wochenende_final }}'
  - action: input_datetime.set_datetime
    target:
      entity_id: input_datetime.aufwachzeit_arbeitstag
    data:
      time: '{{ aufwach_schultag_final }}'
  - action: input_datetime.set_datetime
    target:
      entity_id: input_datetime.aufwachzeit_freier_tag
    data:
      time: '{{ aufwach_wochenende_final }}'
  - action: logbook.log
    data:
      name: Schlafenszeiten angepasst
      message: 'Schultage: schlafen {{ einschlaf_schultag_final[:5] }} / aufstehen
        {{ aufwach_schultag_final[:5] }} - Wochenende: schlafen {{ einschlaf_wochenende_final[:5]
        }} / aufstehen {{ aufwach_wochenende_final[:5] }}'
      domain: automation
  mode: single
