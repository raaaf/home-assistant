# Areas - Arbeitszimmer.Yaml
# Generated by automation splitter - 3 automations
# Part of Home Assistant configuration

- id: '1642078171716'
  alias: Arbeitszimmer » Zustandserkennung
  description: 'Erkennt anhand von Geräten, ob gearbeitet oder gespielt wird, und
    setzt den entsprechenden Zustand. Steuert auch die Beleuchtung direkt.

    '
  triggers:
  - trigger: state
    entity_id: binary_sensor.macbook_pro_2_active
    to: 'on'
    id: work-alex-on
  - trigger: state
    entity_id: binary_sensor.macbook_pro_rafael_active
    to: 'on'
    id: work-rafael-on
  - trigger: state
    entity_id: binary_sensor.macbook_pro_2_active
    to: 'off'
    id: work-alex-off
  - trigger: state
    entity_id: binary_sensor.macbook_pro_rafael_active
    to: 'off'
    id: work-rafael-off
  - trigger: state
    entity_id: binary_sensor.gaming_pc
    to: 'on'
    id: gaming-on
  - trigger: state
    entity_id: binary_sensor.gaming_pc
    to: 'off'
    id: gaming-off
  - trigger: state
    entity_id: input_boolean.gaming
    to: 'on'
    id: gaming-on
  - trigger: state
    entity_id: input_boolean.gaming
    to: 'off'
    id: gaming-off
  - trigger: numeric_state
    entity_id: sensor.sunlight_pct
    below: 40
    id: getting-dark
  - trigger: state
    entity_id: cover.arbeitszimmer_rollo
    to: 'closed'
    id: getting-dark

  condition: []
  action:
  - choose:
    # ==================== ALEX ARBEIT EINSCHALTEN ====================
    - alias: Alex Arbeit einschalten (Decke + Stehlampe)
      conditions:
      - condition: trigger
        id: work-alex-on
      - alias: Gaming ist nicht aktiv
        condition: state
        entity_id: input_boolean.gaming
        state: 'off'
      - alias: Alexandra arbeitet am Studio Display
        condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.macbook_pro_2_displays
          above: 1.5
        - condition: state
          entity_id: sensor.macbook_pro_2_primary_display_name
          state: "Studio Display"
      sequence:
      - alias: "Arbeit aktivieren (falls noch nicht aktiv)"
        if:
        - condition: state
          entity_id: input_boolean.arbeit
          state: 'off'
        then:
        - action: input_boolean.turn_on
          target:
            entity_id: input_boolean.arbeit
      - alias: "Stehlampe einschalten (nur wenn aus)"
        if:
        - condition: state
          entity_id: light.arbeitszimmer_stehlampe
          state: 'off'
        then:
        - action: light.turn_on
          target:
            entity_id: light.arbeitszimmer_stehlampe
          data:
            transition: 2
      - alias: "Decke nur bei Rollo zu oder dunkel einschalten (nur wenn aus)"
        if:
        - condition: and
          conditions:
          - condition: state
            entity_id: light.arbeitszimmer_decke
            state: 'off'
          - condition: or
            conditions:
            - alias: Rollo ist geschlossen
              condition: state
              entity_id: cover.arbeitszimmer_rollo
              state: 'closed'
            - alias: Dunkel draußen
              condition: numeric_state
              entity_id: sensor.sunlight_pct
              below: 40
        then:
        - action: light.turn_on
          target:
            entity_id: light.arbeitszimmer_decke
          data:
            transition: 2

    # ==================== RAFAEL ARBEIT EINSCHALTEN ====================
    - alias: Rafael Arbeit einschalten (PC 1 + PC 2)
      conditions:
      - condition: trigger
        id: work-rafael-on
      - alias: Gaming ist nicht aktiv
        condition: state
        entity_id: input_boolean.gaming
        state: 'off'
      - alias: Rafael arbeitet am Studio Display
        condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.macbook_pro_rafael_displays
          above: 1.5
        - condition: state
          entity_id: sensor.macbook_pro_rafael_primary_display_name
          state: "Studio Display"
      sequence:
      - alias: "Arbeit aktivieren (falls noch nicht aktiv)"
        if:
        - condition: state
          entity_id: input_boolean.arbeit
          state: 'off'
        then:
        - action: input_boolean.turn_on
          target:
            entity_id: input_boolean.arbeit
      - alias: "Rafael Lichter einschalten (PC 1 + PC 2) nur bei Rollo zu oder dunkel (nur wenn aus)"
        if:
        - condition: and
          conditions:
          - alias: Mindestens ein Licht ist aus
            condition: template
            value_template: >
              {{ is_state('light.arbeitszimmer_pc_1', 'off') or
                 is_state('light.arbeitszimmer_pc_2', 'off') }}
          - condition: or
            conditions:
            - alias: Rollo ist geschlossen
              condition: state
              entity_id: cover.arbeitszimmer_rollo
              state: 'closed'
            - alias: Dunkel draußen
              condition: numeric_state
              entity_id: sensor.sunlight_pct
              below: 40
        then:
        - action: light.turn_on
          target:
            entity_id:
            - light.arbeitszimmer_pc_1
            - light.arbeitszimmer_pc_2
          data:
            transition: 2

    # ==================== DUNKEL WAEHREND ARBEIT ====================
    - alias: Lichter einschalten wenn es waehrend der Arbeit dunkel wird
      conditions:
      - condition: trigger
        id: getting-dark
      - alias: Arbeit ist aktiv
        condition: state
        entity_id: input_boolean.arbeit
        state: 'on'
      - alias: Gaming ist nicht aktiv
        condition: state
        entity_id: input_boolean.gaming
        state: 'off'
      sequence:
      - alias: "Alex Decke einschalten wenn sie arbeitet (nur wenn aus)"
        if:
        - condition: state
          entity_id: binary_sensor.macbook_pro_2_active
          state: 'on'
        - condition: state
          entity_id: light.arbeitszimmer_decke
          state: 'off'
        then:
        - action: light.turn_on
          target:
            entity_id: light.arbeitszimmer_decke
          data:
            transition: 2
      - alias: "Rafael PC-Lichter einschalten wenn er arbeitet (nur wenn aus)"
        if:
        - condition: state
          entity_id: binary_sensor.macbook_pro_rafael_active
          state: 'on'
        - condition: template
          value_template: >
            {{ is_state('light.arbeitszimmer_pc_1', 'off') or
               is_state('light.arbeitszimmer_pc_2', 'off') }}
        then:
        - action: light.turn_on
          target:
            entity_id:
            - light.arbeitszimmer_pc_1
            - light.arbeitszimmer_pc_2
          data:
            transition: 2

    # ==================== ALEX ARBEIT AUSSCHALTEN ====================
    - alias: Alex Arbeit ausschalten (Decke + Stehlampe aus)
      conditions:
      - condition: trigger
        id: work-alex-off
      - alias: Gaming ist nicht aktiv (Lichter werden dort evtl. benoetigt)
        condition: state
        entity_id: input_boolean.gaming
        state: 'off'
      sequence:
      - alias: "Alex Lichter ausschalten"
        action: light.turn_off
        target:
          entity_id:
          - light.arbeitszimmer_decke
          - light.arbeitszimmer_stehlampe
        data:
          transition: 2
      - alias: "Arbeit-Szene deaktivieren wenn Rafael auch aus"
        if:
        - condition: state
          entity_id: binary_sensor.macbook_pro_rafael_active
          state: 'off'
        then:
        - action: input_boolean.turn_off
          target:
            entity_id: input_boolean.arbeit
        - delay:
            seconds: 3
        - action: script.scene_enable_adaptive_lighting
          data:
            room: "arbeitszimmer"
            exclude_scenes: ""
        - action: script.scene_enable_motion_automations
          data:
            automations: "automation.arbeitszimmer_motion"
            exclude_scenes: "party"

    # ==================== RAFAEL ARBEIT AUSSCHALTEN ====================
    - alias: Rafael Arbeit ausschalten (PC 1 + PC 2 aus)
      conditions:
      - condition: trigger
        id: work-rafael-off
      - alias: Gaming ist nicht aktiv (PC-Lichter werden dort benoetigt)
        condition: state
        entity_id: input_boolean.gaming
        state: 'off'
      sequence:
      - alias: "Rafael Lichter ausschalten"
        action: light.turn_off
        target:
          entity_id:
          - light.arbeitszimmer_pc_1
          - light.arbeitszimmer_pc_2
        data:
          transition: 2
      - alias: "Arbeit-Szene deaktivieren wenn Alex auch aus"
        if:
        - condition: state
          entity_id: binary_sensor.macbook_pro_2_active
          state: 'off'
        then:
        - action: input_boolean.turn_off
          target:
            entity_id: input_boolean.arbeit
        - delay:
            seconds: 3
        - action: script.scene_enable_adaptive_lighting
          data:
            room: "arbeitszimmer"
            exclude_scenes: ""
        - action: script.scene_enable_motion_automations
          data:
            automations: "automation.arbeitszimmer_motion"
            exclude_scenes: "party"
    - alias: Gaming einschalten
      conditions:
      - condition: trigger
        id: gaming-on
      sequence:
      - action: input_boolean.turn_on
        target:
          entity_id: input_boolean.gaming
      - alias: "Adaptive Lighting sofort ausschalten (Race Condition vermeiden)"
        action: switch.turn_off
        target:
          entity_id: switch.adaptive_lighting_arbeitszimmer
      - delay:
          seconds: 1
      - alias: "Decke und Stehlampe ausschalten wenn nicht gearbeitet wird"
        if:
        - condition: state
          entity_id: input_boolean.arbeit
          state: 'off'
        then:
        - action: light.turn_off
          target:
            entity_id:
            - light.arbeitszimmer_decke
            - light.arbeitszimmer_stehlampe
          data:
            transition: 2
      - alias: "PC 1 Gaming-Farbe (Blau)"
        action: light.turn_on
        target:
          entity_id: light.arbeitszimmer_pc_1
        data:
          hs_color: [230, 100]
          brightness_pct: 50
      - alias: "PC 2 Gaming-Farbe (Magenta)"
        action: light.turn_on
        target:
          entity_id: light.arbeitszimmer_pc_2
        data:
          hs_color: [290, 85]
          brightness_pct: 50
    - alias: Gaming ausschalten
      conditions:
      - condition: trigger
        id: gaming-off
      sequence:
      - action: input_boolean.turn_off
        target:
          entity_id: input_boolean.gaming
        data: {}
      - alias: "Gaming-Lichter ausschalten"
        action: light.turn_off
        target:
          entity_id:
          - light.arbeitszimmer_pc_1
          - light.arbeitszimmer_pc_2
        data:
          transition: 2
      - alias: "Pruefen ob jemand arbeitet"
        choose:
        - alias: "Jemand arbeitet - Arbeit aktivieren"
          conditions:
          - condition: or
            conditions:
            - condition: state
              entity_id: binary_sensor.macbook_pro_rafael_active
              state: 'on'
            - condition: state
              entity_id: binary_sensor.macbook_pro_2_active
              state: 'on'
          sequence:
          - action: input_boolean.turn_on
            target:
              entity_id: input_boolean.arbeit
          - alias: "Rafael Lichter einschalten wenn aktiv und dunkel"
            if:
            - condition: and
              conditions:
              - condition: state
                entity_id: binary_sensor.macbook_pro_rafael_active
                state: 'on'
              - condition: or
                conditions:
                - condition: state
                  entity_id: cover.arbeitszimmer_rollo
                  state: 'closed'
                - condition: numeric_state
                  entity_id: sensor.sunlight_pct
                  below: 40
            then:
            - action: light.turn_on
              target:
                entity_id:
                - light.arbeitszimmer_pc_1
                - light.arbeitszimmer_pc_2
              data:
                transition: 2
          - alias: "Alex Lichter einschalten wenn aktiv und dunkel"
            if:
            - condition: and
              conditions:
              - condition: state
                entity_id: binary_sensor.macbook_pro_2_active
                state: 'on'
              - condition: or
                conditions:
                - condition: state
                  entity_id: cover.arbeitszimmer_rollo
                  state: 'closed'
                - condition: numeric_state
                  entity_id: sensor.sunlight_pct
                  below: 40
            then:
            - action: light.turn_on
              target:
                entity_id:
                - light.arbeitszimmer_stehlampe
                - light.arbeitszimmer_decke
              data:
                transition: 2
        default:
        - alias: "Niemand arbeitet - Decke aus + AL reaktivieren"
          action: light.turn_off
          target:
            entity_id: light.arbeitszimmer_decke
          data:
            transition: 2
        - delay:
            seconds: 3
        - action: script.scene_enable_adaptive_lighting
          data:
            room: "arbeitszimmer"
            exclude_scenes: ""
  mode: restart
- id: '1730279567232'
  alias: Motion » Arbeitszimmer
  description: Bewegungsgesteuerte Beleuchtung im Arbeitszimmer mit Nachtlicht-Modus
    und Anwesenheitserkennung
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.arbeitszimmer_motion_occupancy
      light_switch:
        entity_id: light.alle_arbeitszimmer_lichter
      include_night_lights: night_lights_enabled
      night_lights:
        entity_id: light.alle_arbeitszimmer_nachtlichter
      night_lights_conditions:
      - entity_state_enabled
      night_lights_entity_state:
      - input_boolean.schlafenszeit
      include_sun: sun_disabled
      time_delay: 1
      night_time_delay: 1
      include_night_light_control:
      - if_lights_are_on_adjust_when_crossing_over
      night_lights_after_time: '19:00:00'
      night_lights_before_time: 07:00:00
      include_ambient: ambient_enabled
      ambient_light_sensor: sensor.balkon_motion_illuminance_safe
      ambient_light_value: 150
      ambient_light_high_value: 200
      include_bypass:
      - bypass_enabled_stop
      motion_bypass_lights_stop:
      - binary_sensor.arbeitszimmer_manual_control
      - input_boolean.arbeit  # Don't turn off lights while working
      - input_boolean.gaming  # Don't turn off lights while gaming
