# Areas - Schlafzimmer.Yaml
# Generated by automation splitter - 3 automations
# Part of Home Assistant configuration

- id: '1652698714339'
  alias: Schlafzimmer » Luftreiniger
  description: 'Steuert den Luftreiniger basierend auf PM2.5-Werten (Aus < 10, Ein
    > 20 für je 1 Minute). Verhindert unnötige Schaltzyklen durch Hysterese.

    '
  trigger:
  - trigger: numeric_state
    entity_id: sensor.zhimi_vb4_bce4_pm25_density
    below: 10
    for:
      minutes: 1
    id: excellent
  - trigger: numeric_state
    entity_id: sensor.zhimi_vb4_bce4_pm25_density
    above: 20
    for:
      minutes: 1
    id: poor
  - trigger: state
    entity_id: input_boolean.schlafenszeit
    to: 'on'
    id: sleep_start
  - trigger: state
    entity_id: input_boolean.schlafenszeit
    to: 'off'
    id: sleep_end
  condition: []
  action:
  - choose:
    - alias: Schlafenszeit gestartet - Luftreiniger einschalten (Sleep)
      conditions:
      - condition: trigger
        id: sleep_start
      - alias: Jemand ist zu Hause
        condition: state
        entity_id: input_boolean.alle_sind_weg
        state: 'off'
      - alias: Luftreiniger ist verfügbar
        condition: template
        value_template: '{{ has_value(''fan.zhimi_vb4_bce4_air_purifier'') }}'

        
      sequence:
      - alias: Luftreiniger einschalten
        action: fan.turn_on
        target:
          entity_id: fan.zhimi_vb4_bce4_air_purifier
      - alias: Schlaf-Modus setzen wenn nötig
        condition: template
        value_template: "{{ state_attr('fan.zhimi_vb4_bce4_air_purifier', 'preset_mode') != 'Sleep' }}"
      - alias: Schlaf-Modus aktivieren
        action: fan.set_preset_mode
        target:
          entity_id: fan.zhimi_vb4_bce4_air_purifier
        data:
          preset_mode: Sleep
    - alias: Schlafenszeit beendet - Gute Luft -> ausschalten
      conditions:
      - condition: trigger
        id: sleep_end
      - alias: Sensor ist verfügbar
        condition: template
        value_template: '{{ has_value(''sensor.zhimi_vb4_bce4_pm25_density'') }}'

        
      - alias: Luft ist gut (<10)
        condition: numeric_state
        entity_id: sensor.zhimi_vb4_bce4_pm25_density
        below: 10
      - alias: Luftreiniger läuft gerade
        condition: template
        value_template: "{{ has_value('fan.zhimi_vb4_bce4_air_purifier') and is_state('fan.zhimi_vb4_bce4_air_purifier', 'on') }}"
      sequence:
      - alias: Luftreiniger ausschalten
        action: fan.turn_off
        target:
          entity_id: fan.zhimi_vb4_bce4_air_purifier
    - alias: Luftqualität exzellent - Luftreiniger ausschalten
      conditions:
      - condition: trigger
        id: excellent
      - alias: Luftreiniger läuft gerade
        condition: template
        value_template: "{{ has_value('fan.zhimi_vb4_bce4_air_purifier') and is_state('fan.zhimi_vb4_bce4_air_purifier', 'on') }}"
      - alias: Luftreiniger ist verfügbar
        condition: template
        value_template: '{{ has_value(''fan.zhimi_vb4_bce4_air_purifier'') }}'

        
      - alias: Sensor ist verfügbar
        condition: template
        value_template: '{{ has_value(''sensor.zhimi_vb4_bce4_pm25_density'') }}

          '
      - alias: Nicht ausschalten wenn Schlafenszeit aktiv und jemand zu Hause
        condition: or
        conditions:
        - condition: state
          entity_id: input_boolean.schlafenszeit
          state: 'off'
        - condition: state
          entity_id: input_boolean.alle_sind_weg
          state: 'on'
      sequence:
      - alias: Luftreiniger ausschalten
        action: fan.turn_off
        target:
          entity_id: fan.zhimi_vb4_bce4_air_purifier
    - alias: Luftqualität schlecht - Luftreiniger einschalten
      conditions:
      - condition: trigger
        id: poor
      - alias: Luftreiniger läuft nicht
        condition: template
        value_template: "{{ has_value('fan.zhimi_vb4_bce4_air_purifier') and is_state('fan.zhimi_vb4_bce4_air_purifier', 'off') }}"
      - alias: Jemand ist zu Hause
        condition: state
        entity_id: input_boolean.alle_sind_weg
        state: 'off'
      - alias: Luftreiniger ist verfügbar
        condition: template
        value_template: '{{ has_value(''fan.zhimi_vb4_bce4_air_purifier'') }}'

        
      - alias: Sensor ist verfügbar
        condition: template
        value_template: '{{ has_value(''sensor.zhimi_vb4_bce4_pm25_density'') }}

          '
      sequence:
      - alias: Luftreiniger einschalten
        action: fan.turn_on
        target:
          entity_id: fan.zhimi_vb4_bce4_air_purifier
      - alias: Passenden Modus setzen (Schlaf/Auto)
        choose:
        - conditions:
          - alias: Schlafenszeit ist aktiv
            condition: state
            entity_id: input_boolean.schlafenszeit
            state: 'on'
          - alias: Jemand ist zu Hause
            condition: state
            entity_id: input_boolean.alle_sind_weg
            state: 'off'
          sequence:
          - alias: Schlaf-Modus setzen wenn nötig
            condition: template
            value_template: "{{ state_attr('fan.zhimi_vb4_bce4_air_purifier', 'preset_mode') != 'Sleep' }}"
          - alias: Schlaf-Modus aktivieren
            action: fan.set_preset_mode
            target:
              entity_id: fan.zhimi_vb4_bce4_air_purifier
            data:
              preset_mode: Sleep
        default:
        - alias: Auto-Modus setzen wenn nötig
          condition: template
          value_template: "{{ state_attr('fan.zhimi_vb4_bce4_air_purifier', 'preset_mode') != 'Auto' }}"
        - alias: Auto-Modus aktivieren
          action: fan.set_preset_mode
          target:
            entity_id: fan.zhimi_vb4_bce4_air_purifier
          data:
            preset_mode: Auto
  mode: single
- id: '1678724233791'
  alias: Motion » Schlafzimmer
  description: Bewegungsgesteuerte Beleuchtung im Schlafzimmer mit Nachtlicht-Modus
    und Anwesenheitserkennung
  use_blueprint:
    path: Blackshome/sensor-light.yaml
    input:
      motion_trigger:
      - binary_sensor.schlafzimmer_motion_occupancy
      light_switch:
        entity_id: light.alle_schlafzimmer_lichter
      include_night_lights: night_lights_enabled
      night_lights:
        entity_id: light.alle_schlafzimmer_nachtlichter
      night_lights_conditions:
      - entity_state_enabled
      night_lights_entity_state:
      - input_boolean.schlafenszeit
      include_sun: sun_disabled
      time_delay: 1
      night_time_delay: 1
      include_night_light_control:
      - if_lights_are_on_adjust_when_crossing_over
      night_lights_after_time: '19:00:00'
      night_lights_before_time: 05:30:00
      include_ambient: ambient_enabled
      ambient_light_sensor: sensor.balkon_motion_illuminance_safe
      ambient_light_value: 150
      ambient_light_high_value: 200
      # Bypass motion turn-off when manual control is active
      include_bypass:
      - bypass_enabled_stop
      motion_bypass_lights_stop:
      - binary_sensor.schlafzimmer_manual_control
- id: '1737544939682'
  alias: Helper » Steckdose Arbeitszimmer
  description: 'Schaltet Arbeitszimmer-Steckdose automatisch ein,
    wenn sie wieder verfügbar ist – aber nur wenn jemand zu Hause ist.

    '
  trigger:
  - entity_id: switch.arbeitszimmer_steckdose
    from: unavailable
    trigger: state
  condition:
  - condition: state
    entity_id: input_boolean.alle_sind_weg
    state: 'off'
  action:
  - condition: state
    entity_id: switch.arbeitszimmer_steckdose
    state: 'off'
  - target:
      entity_id: switch.arbeitszimmer_steckdose
    action: switch.turn_on
  mode: single
- id: 'schlafzimmer_appletv_ambilight'
  alias: 'Licht » Schlafzimmer TV Ambilight'
  description: Schaltet Ambilight ein wenn Apple TV abspielt, deaktiviert Motion-Automation
  triggers:
    - trigger: state
      entity_id: media_player.appletv
      to: playing
      id: playing
    - trigger: state
      entity_id: media_player.appletv
      from: playing
      id: stopped
    - trigger: time_pattern
      seconds: "/30"
      id: poll-check
  conditions:
    - condition: or
      conditions:
        - condition: and
          conditions:
            - condition: trigger
              id:
                - playing
                - stopped
            - condition: template
              value_template: "{{ has_value('media_player.appletv') }}"
        - condition: and
          conditions:
            - condition: template
              value_template: "{{ is_state('media_player.appletv', 'playing') and has_value('media_player.appletv') }}"
            - condition: state
              entity_id: automation.motion_schlafzimmer
              state: 'on'
  actions:
    - choose:
        - conditions:
            - condition: trigger
              id:
                - playing
                - poll-check
          sequence:
            - action: automation.turn_off
              target:
                entity_id: automation.motion_schlafzimmer
              data:
                stop_actions: true
            - action: switch.turn_off
              target:
                entity_id: switch.adaptive_lighting_adapt_brightness_schlafzimmer
            - delay:
                milliseconds: 300
            - action: light.turn_off
              target:
                entity_id: light.alle_schlafzimmer_lichter
            - delay:
                milliseconds: 500
            - action: light.turn_on
              target:
                entity_id: light.schlafzimmer_tv
              data:
                brightness_pct: 30
            - delay:
                milliseconds: 500
            - action: adaptive_lighting.apply
              data:
                entity_id: switch.adaptive_lighting_schlafzimmer
                lights:
                  - light.schlafzimmer_tv
                adapt_brightness: false
                adapt_color: true
        - conditions:
            - condition: trigger
              id: stopped
          sequence:
            - action: light.turn_off
              target:
                entity_id: light.schlafzimmer_tv
            - action: switch.turn_on
              target:
                entity_id: switch.adaptive_lighting_adapt_brightness_schlafzimmer
            - action: automation.turn_on
              target:
                entity_id: automation.motion_schlafzimmer
  mode: single
