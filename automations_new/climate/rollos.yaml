# Climate - Rollos.Yaml
# Generated by automation splitter - 1 automations
# Part of Home Assistant configuration

- id: '1692259868217'
  alias: Rollos Â» All in one (Optimiert)
  description: 'Intelligente Rollosteuerung basierend auf: - Tageszeit und Aufwachzeiten
    - Sonnenstand (Azimuth & Elevation) - Temperaturvorhersage - Anwesenheit'
  trigger:
  - id: morgens-arbeitstag
    trigger: time
    at:
      entity_id: input_datetime.aufwachzeit_arbeitstag
      offset: 00:12:00
  - id: morgens-freiertag
    trigger: time
    at:
      entity_id: input_datetime.aufwachzeit_freier_tag
      offset: 00:12:00
  - at: 09:00:00
    id: vormittag
    trigger: time
  - entity_id: sensor.sun_azimuth
    above: 135
    id: sonne-suedost
    trigger: numeric_state
  - entity_id: sensor.sun_azimuth
    above: 180
    id: sonne-sued
    trigger: numeric_state
  - entity_id: sensor.sun_azimuth
    above: 225
    id: sonne-suedwest
    trigger: numeric_state
  - entity_id: sun.sun
    attribute: elevation
    below: 0
    id: sonnenuntergang
    trigger: numeric_state
  - entity_id: input_boolean.schlafenszeit
    to: 'on'
    id: schlafenszeit
    trigger: state
  condition: []
  action:
  - variables:
      wird_sehr_heiss: '{{ has_value(''input_boolean.heute_wird_es_sehr_heiss_werden'') and is_state(''input_boolean.heute_wird_es_sehr_heiss_werden'',
        ''on'') }}'
      wird_heiss: '{{ has_value(''input_boolean.heute_wird_es_heiss_werden'') and is_state(''input_boolean.heute_wird_es_heiss_werden'', ''on'')
        }}'
      ist_arbeitstag: '{{ has_value(''binary_sensor.workday_sensor'') and is_state(''binary_sensor.workday_sensor'', ''on'') }}'
      position_schlaf_kinder: "{% if wird_sehr_heiss %}5{% elif wird_heiss %}25{% else %}100{% endif %}"
      position_arbeit: 1
      position_west: "{% if wird_sehr_heiss %}0{% elif wird_heiss %}10{% else %}100{% endif %}"
  - choose:
    - conditions:
      - condition: trigger
        id: morgens-arbeitstag
      - condition: template
        value_template: '{{ ist_arbeitstag }}'
      sequence:
      - action: cover.set_cover_position
        data:
          position: '{{ position_schlaf_kinder }}'
        target:
          entity_id:
          - cover.kinderzimmer_rollo
          - cover.schlafzimmer_rollo
      - action: cover.set_cover_position
        data:
          position: '{{ position_arbeit }}'
        target:
          entity_id: cover.arbeitszimmer_rollo
      - action: notify.persistent_notification
        data:
          title: ðŸªŸ Rollos Morgen
          message: 'Arbeitstag {{ now().strftime(''%H:%M'') }} Temperatur-Modus: {{
            ''Sehr heiÃŸ'' if wird_sehr_heiss else ''HeiÃŸ'' if wird_heiss else ''Normal''
            }} Positionen: Schlaf/Kinder {{ position_schlaf_kinder }}%, Arbeit {{
            position_arbeit }}%

            '
    - conditions:
      - condition: trigger
        id: morgens-freiertag
      - condition: template
        value_template: '{{ not ist_arbeitstag }}'
      sequence:
      - action: cover.set_cover_position
        data:
          position: '{{ position_schlaf_kinder }}'
        target:
          entity_id: cover.rollos_sonnenaufgang
      - action: cover.set_cover_position
        data:
          position: '{{ position_arbeit }}'
        target:
          entity_id: cover.arbeitszimmer_rollo
    - conditions:
      - condition: trigger
        id: vormittag
      - condition: template
        value_template: '{{ wird_sehr_heiss or wird_heiss }}'
      sequence:
      - action: cover.set_cover_position
        data:
          position: '{{ 0 if wird_sehr_heiss else 10 }}'
        target:
          entity_id: cover.rollos_sonnenaufgang
      - action: notify.persistent_notification
        data:
          title: ðŸªŸ Rollos 9 Uhr
          message: Hitzeschutz verschÃ¤rft - Ost-Rollos auf {{ 0 if wird_sehr_heiss
            else 10 }}%
    - conditions:
      - condition: trigger
        id: sonne-sued
      sequence:
      - action: cover.set_cover_position
        data:
          position: '{{ 100 if not wird_sehr_heiss else 50 }}'
        target:
          entity_id: cover.rollos_sonnenaufgang
      - if:
        - condition: template
          value_template: '{{ wird_sehr_heiss or wird_heiss }}'
        then:
        - action: cover.set_cover_position
          data:
            position: '{{ position_west }}'
          target:
            entity_id:
            - cover.wohnzimmer_rollo
          continue_on_error: true
        - choose:
          - conditions:
            - condition: template
              value_template: '{{ position_west < 50 }}'
            sequence:
            - action: cover.close_cover
              target:
                entity_id:
                - cover.rollo_kueche
                - cover.rollo_balkon
              data: {}
          - conditions:
            - condition: template
              value_template: '{{ position_west >= 50 }}'
            sequence:
            - action: cover.open_cover
              target:
                entity_id:
                - cover.rollo_kueche
                - cover.rollo_balkon
              data: {}
    - conditions:
      - condition: trigger
        id:
        - sonnenuntergang
        - schlafenszeit
      sequence:
      - action: cover.close_cover
        target:
          entity_id:
          - cover.rollos_sonnenaufgang
          - cover.arbeitszimmer_rollo
        data: {}
      - action: cover.open_cover
        target:
          entity_id:
          - cover.rollo_balkon
          - cover.rollo_kueche
          - cover.wohnzimmer_rollo
        data: {}
  mode: single
