# Helpers - Automation.Yaml
# Generated by automation splitter - 5 automations
# Part of Home Assistant configuration

- id: '1696241451967'
  alias: Helper » Workday Musik
  description: 'Startet sanfte Musik zum Aufwachen an Werktagen. Nutzt alle HomePods
    (4 Minis + 2 OG) in einer Gruppe.

    '
  triggers:
  - at: sensor.wakeup_light_timestamp
    trigger: time
    id: wakeup-time
  conditions:
  - condition: state
    entity_id: input_boolean.alle_sind_weg
    state: 'off'
  - condition: template
    value_template: "{{ has_value('input_boolean.alle_sind_weg') }}"
  - condition: time
    after: 05:00:00
    before: '10:00:00'
  actions:
  - action: media_player.volume_set
    data:
      volume_level: 0
    target:
      entity_id: media_player.homepods
  - wait_template: '{{ state_attr(''media_player.homepods'', ''volume_level'') | float(1)
      <= 0.01 }}'
    timeout: 00:00:05
    continue_on_timeout: true
  - action: input_boolean.turn_on
    target:
      entity_id:
      - input_boolean.werktag_aufwachen
      - input_boolean.werktag_musik
    data: {}
  - wait_template: '{{ has_value(''media_player.homepods'') and is_state(''media_player.homepods'', ''playing'') }}'
    timeout: 00:00:15
    continue_on_timeout: true
  - delay: 00:00:03
  - if:
    - condition: template
      value_template: '{{ state_attr(''media_player.homepods'', ''volume_level'')
        | float(0) > 0.1 }}'
    then:
    - action: media_player.volume_set
      data:
        volume_level: 0.01
      target:
        entity_id: media_player.homepods
    - delay: 00:00:01
  - action: script.fade_volume
    data:
      curve: linear
      target_player: media_player.homepods
      duration: 600
      target_volume: 0.45
  - delay: 00:04:05
  - action: input_boolean.turn_off
    target:
      entity_id:
      - input_boolean.werktag_musik
      - input_boolean.werktag_aufwachen
    data: {}
  - action: logbook.log
    data:
      name: Guten Morgen Musik
      message: 'Wakeup Musik gestartet um {{ as_timestamp(states(''sensor.wakeup_light_timestamp''))
        | timestamp_custom(''%H:%M'') }} - HomePods (6 Geräte): {{ (state_attr(''media_player.homepods'',
        ''volume_level'') | float(0) * 100) | round(0) }}% Läuft: {{ state_attr(''media_player.homepods'',
        ''media_title'') | default(''Apple Home Musik'') }} - Fade: 4 Min mit Bezier-Kurve'
      domain: automation
  mode: single
