# Helpers - Energy.Yaml
# Generated by automation splitter - 2 automations
# Part of Home Assistant configuration

- id: '1729846723165'
  alias: Helper ¬ª Cowboys
  description: '√úberwacht Akkustand und Reichweite der Cowboy E-Bikes und sendet Benachrichtigungen

    '
  triggers:
  - entity_id: sensor.rennsemmel_remaining_battery
    below: 25
    id: rennsemmel-battery
    trigger: numeric_state
  - entity_id: sensor.rennsemmel_remaining_range
    below: 10
    id: rennsemmel-range
    enabled: false
    trigger: numeric_state
  - entity_id: sensor.butzabatza_remaining_range
    below: 10
    id: butzabatza-range
    enabled: false
    trigger: numeric_state
  - entity_id: sensor.butzabatza_remaining_battery
    below: 25
    id: butzabatza-battery
    trigger: numeric_state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: rennsemmel-battery
      sequence:
      - parallel:
          # TTS Ansage √ºber HomePods
          - action: script.hausgeraete_ansage
            data:
              message: "Alex, dein E-Bike Akku ist unter 25 Prozent. Zeit zum Laden"
              priority: "normal"
          
          # Mobile Benachrichtigung
          - action: notify.alex
            data:
              title: üöµ‚Äç‚ôÄÔ∏è Cowboy Battery <= 25%
              message: Wie w√§re es mit laden?
          
          # Persistent Notification als Backup
          - action: persistent_notification.create
            data:
              notification_id: "ebike_alex_battery"
              title: "üö¥ E-Bike Akku niedrig"
              message: "Alex's E-Bike: {{ states('sensor.rennsemmel_remaining_battery') }}% Akku verbleibend"
    - conditions:
      - condition: trigger
        id: butzabatza-battery
      sequence:
      - parallel:
          # TTS Ansage √ºber HomePods
          - action: script.hausgeraete_ansage
            data:
              message: "Rafael, dein E-Bike Akku ist unter 25 Prozent. Zeit zum Laden"
              priority: "normal"
          
          # Mobile Benachrichtigung
          - action: notify.rafael
            data:
              title: üöµ‚Äç‚ôÄÔ∏è Cowboy Battery <= 25%
              message: Wie w√§re es mit laden?
          
          # Persistent Notification als Backup
          - action: persistent_notification.create
            data:
              notification_id: "ebike_rafael_battery"
              title: "üö¥ E-Bike Akku niedrig"
              message: "Rafael's E-Bike: {{ states('sensor.butzabatza_remaining_battery') }}% Akku verbleibend"
    - conditions:
      - condition: trigger
        id: rennsemmel-range
      sequence:
      - data:
          title: üöµ‚Äç‚ôÄÔ∏è Cowboy Reichweite <= 10km
          message: Wie w√§re es mit laden?
        action: notify.alex
    - conditions:
      - condition: trigger
        id: butzabatza-range
      sequence:
      - data:
          title: üöµ‚Äç‚ôÄÔ∏è Cowboy Reichweite <= 10km
          message: Wie w√§re es mit laden?
        action: notify.rafael
  mode: restart
- id: '1745924954227'
  alias: Helper ¬ª Speichere Solarproduktion gestern
  description: 'Speichert die Tagesproduktion der Solaranlage kurz vor Mitternacht
    in eine Input Number f√ºr die sp√§tere Verwendung

    '
  triggers:
  - at: '23:55:00'
    trigger: time
  conditions:
  - condition: template
    value_template: '{{ states(''sensor.dtu_ac_daily_energy'') not in [''unknown'',
      ''unavailable''] }}

      '
  actions:
  - data:
      entity_id: input_number.solarproduktion_gestern
      value: '{{ (states(''sensor.dtu_ac_daily_energy'') | float(0) / 1000) | round(2)
        }}

        '
    action: input_number.set_value
  - data:
      message: 'Solarproduktion gespeichert: {{ (states(''sensor.dtu_ac_daily_energy'')
        | float(0) / 1000) | round(2) }} kWh

        '
      name: Solar Helper
      domain: automation
    action: logbook.log
  mode: single
