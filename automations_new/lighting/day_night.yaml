# Lighting - Day Night.Yaml
# Generated by automation splitter - 3 automations
# Part of Home Assistant configuration

- id: '1645377860470'
  alias: State » Tag/Nacht
  description: Steuert Tag/Nacht-Übergänge mit Alarm, Beleuchtung und adaptiver Beleuchtung
  triggers:
  - trigger: time
    at: sensor.wakeup_light_timestamp
    id: wakeup
  - trigger: numeric_state
    entity_id: sun.sun
    attribute: elevation
    above: -3.5
    id: sun
  - trigger: time
    at: 07:00:00
    id: sun
  - trigger: time
    at: sensor.einschlafzeit_timestamp
    id: einschlafzeit
  - trigger: state
    entity_id: input_boolean.schlafenszeit
    from: 'off'
    to: 'on'
    for: 00:00:30
    id: early-schlafenszeit
  - trigger: time
    at: '22:00:00'
    id: schlafenszeit
  conditions: []
  actions:
  - choose:
    - alias: Aufwachen - Alarm deaktivieren und sanftes Licht
      conditions:
      - condition: trigger
        id: wakeup
      sequence:
      - alias: Alarm deaktivieren
        action: alarm_control_panel.alarm_disarm
        target:
          entity_id: alarm_control_panel.alarmo
      - alias: Schlafenszeit beenden
        action: input_boolean.turn_off
        target:
          entity_id: input_boolean.schlafenszeit
      - alias: Sanftes Aufwachlicht nur an Werktagen wenn jemand da ist
        if:
        - alias: Ist Werktag
          condition: state
          entity_id: binary_sensor.workday_sensor
          state: 'on'
        - condition: template
          value_template: "{{ has_value('binary_sensor.workday_sensor') and has_value('input_boolean.alle_sind_weg') }}"
        - alias: Jemand ist zu Hause
          condition: state
          entity_id: input_boolean.alle_sind_weg
          state: 'off'
        then:
        - alias: Adaptive Beleuchtung Helligkeit temporär deaktivieren
          action: switch.turn_off
          target:
            entity_id:
            - switch.adaptive_lighting_adapt_brightness_arbeitszimmer
            - switch.adaptive_lighting_adapt_brightness_kinderzimmer
            - switch.adaptive_lighting_adapt_brightness_schlafzimmer
        - alias: Motion-Automationen temporär deaktivieren
          action: automation.turn_off
          target:
            entity_id:
            - automation.arbeitszimmer_motion
            - automation.1692710690350
            - automation.1678724233791
          data:
            stop_actions: true
        - alias: Lichter sehr schwach einschalten (1%)
          action: light.turn_on
          target:
            entity_id:
            - light.alle_arbeitszimmer_lichter
            - light.alle_schlafzimmer_lichter
            - light.alle_kinderzimmer_lichter
          data:
            brightness_pct: 1
        - alias: Sanfter Übergang zu 100% über 15 Minuten
          action: light.turn_on
          target:
            entity_id:
            - light.alle_arbeitszimmer_lichter
            - light.alle_schlafzimmer_lichter
            - light.alle_kinderzimmer_lichter
          data:
            brightness_pct: 100
            transition: 900
        # Alternative: Sunrise Simulator Script (deaktiviert)
        # - action: script.sunrise_simulator
        #   data:
        #     duration: 30
        #     target:
        #     - light.alle_schlafzimmer_lichter
        #     - light.alle_kinderzimmer_lichter
        #     - light.alle_arbeitszimmer_lichter
        #     max_brightness: 100
        # 10 Minuten warten (deaktiviert)
        # - delay: 00:10:00
        - alias: Motion-Automationen wieder aktivieren
          action: automation.turn_on
          target:
            entity_id:
            - automation.arbeitszimmer_motion
            - automation.1692710690350
            - automation.1678724233791
        - alias: Adaptive Beleuchtung Helligkeit wieder aktivieren
          action: switch.turn_on
          target:
            entity_id:
            - switch.adaptive_lighting_adapt_brightness_arbeitszimmer
            - switch.adaptive_lighting_adapt_brightness_kinderzimmer
            - switch.adaptive_lighting_adapt_brightness_schlafzimmer
      - alias: Sleep Mode für alle Räume deaktivieren
        action: switch.turn_off
        target:
          entity_id:
          - switch.adaptive_lighting_sleep_mode_arbeitszimmer
          - switch.adaptive_lighting_sleep_mode_badezimmer
          - switch.adaptive_lighting_sleep_mode_balkon
          - switch.adaptive_lighting_sleep_mode_flur
          - switch.adaptive_lighting_sleep_mode_kinderzimmer
          - switch.adaptive_lighting_sleep_mode_kueche
          - switch.adaptive_lighting_sleep_mode_waschzimmer
          - switch.adaptive_lighting_sleep_mode_wohnzimmer
          - switch.adaptive_lighting_sleep_mode_schlafzimmer
    - alias: Sonnenaufgang - Schlafenszeit beenden
      conditions:
      - condition: trigger
        id: sun
      sequence:
      - alias: Schlafenszeit automatisch beenden bei Sonnenaufgang
        action: input_boolean.turn_off
        target:
          entity_id: input_boolean.schlafenszeit
    - alias: Einschlafzeit - Schlafmodus aktivieren
      conditions:
      - condition: trigger
        id: einschlafzeit
      sequence:
      - alias: Schlafenszeit aktivieren
        action: input_boolean.turn_on
        target:
          entity_id: input_boolean.schlafenszeit
      - alias: Automation-Zeitfenster auf nächste Dämmerung setzen
        action: input_datetime.set_datetime
        target:
          entity_id: input_datetime.automation_lauft_nicht_vor
        data:
          timestamp: '{{ (state_attr(''sun.sun'', ''next_dusk'')|as_datetime).timestamp()
            }}'
      - alias: Automation-Zeitfenster auf nächste Morgendämmerung setzen
        action: input_datetime.set_datetime
        target:
          entity_id: input_datetime.automation_lauft_erst_ab
        data:
          timestamp: '{{ (state_attr(''sun.sun'', ''next_dawn'')|as_datetime).timestamp()
            }}'
      - alias: Klimaanlage auf Schlafmodus (wenn verfügbar)
        if:
        - alias: Klimaanlage ist verfügbar
          condition: not
          conditions:
          - condition: state
            entity_id: climate.ac
            state: unavailable
        then:
        - action: climate.set_preset_mode
          target:
            entity_id: climate.ac
          data:
            preset_mode: sleep
    - alias: Frühe Schlafenszeit - Sleep Mode für wichtige Räume
      conditions:
      - condition: trigger
        id: early-schlafenszeit
      sequence:
      - alias: Sleep Mode für Haupträume aktivieren
        action: switch.turn_on
        target:
          entity_id:
          - switch.adaptive_lighting_sleep_mode_flur
          - switch.adaptive_lighting_sleep_mode_kinderzimmer
          - switch.adaptive_lighting_sleep_mode_arbeitszimmer
          - switch.adaptive_lighting_sleep_mode_schlafzimmer
    - alias: 22:00 Uhr - Kompletter Nachtmodus
      conditions:
      - condition: trigger
        id: schlafenszeit
      sequence:
      - alias: Sleep Mode für alle Räume aktivieren
        action: switch.turn_on
        target:
          entity_id:
          - switch.adaptive_lighting_sleep_mode_badezimmer
          - switch.adaptive_lighting_sleep_mode_balkon
          - switch.adaptive_lighting_sleep_mode_flur
          - switch.adaptive_lighting_sleep_mode_kueche
          - switch.adaptive_lighting_sleep_mode_waschzimmer
          - switch.adaptive_lighting_sleep_mode_wohnzimmer
          - switch.adaptive_lighting_sleep_mode_kinderzimmer
          - switch.adaptive_lighting_sleep_mode_arbeitszimmer
          - switch.adaptive_lighting_sleep_mode_schlafzimmer
      - alias: Hauptlichter in Schlaf-/Kinderzimmern ausschalten
        action: light.turn_off
        target:
          entity_id:
          - light.alle_kinderzimmer_lichter
          - light.alle_schlafzimmer_lichter
          - light.alle_arbeitszimmer_lichter
  mode: queued
  max: 10
- id: '1731401667299'
  alias: Helper » Sunrise Toggle
  description: Deaktiviert Bewegungsmelder und adaptive Beleuchtung während des Sonnenaufgangs
    (6:30-8:00)
  triggers:
  - trigger: time
    at: 06:30:00
    id: 'on'
  - trigger: time
    at: 08:01:00
    id: 'off'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - 'on'
      - condition: state
        entity_id: binary_sensor.workday_sensor
        state: 'on'
      - condition: template
        value_template: "{{ has_value('binary_sensor.workday_sensor') and has_value('input_boolean.alle_sind_weg') }}"
      - condition: state
        entity_id: input_boolean.alle_sind_weg
        state: 'off'
      sequence:
      - action: automation.turn_off
        target:
          entity_id:
          - automation.1692710690350
          - automation.arbeitszimmer_motion
          - automation.1678724233791
        data:
          stop_actions: true
      - action: switch.turn_off
        data: {}
        target:
          entity_id:
          - switch.adaptive_lighting_arbeitszimmer
          - switch.adaptive_lighting_kinderzimmer
    - conditions:
      - condition: trigger
        id:
        - 'off'
      sequence:
      - alias: Check if other scenes need motion sensors disabled
        condition: and
        conditions:
          - condition: template
            value_template: >-
              {{ has_value('input_boolean.gaming') and states('input_boolean.gaming') == 'off' and
                 has_value('input_boolean.party') and states('input_boolean.party') == 'off' and
                 has_value('input_boolean.lesen') and states('input_boolean.lesen') == 'off' }}
      - action: automation.turn_on
        target:
          entity_id:
          - automation.1692710690350
          - automation.arbeitszimmer_motion
          - automation.1678724233791
        data: {}
      - action: switch.turn_on
        data: {}
        target:
          entity_id:
          - switch.adaptive_lighting_arbeitszimmer
          - switch.adaptive_lighting_kinderzimmer
  mode: single
- id: es_ist_dunkel_toggle
  alias: Helper » Dunkel – an/aus je nach Sonnenstand
  description: Schaltet den Boolean ein bei Sonnenuntergang und aus bei Sonnenaufgang.
  triggers:
  - event: sunset
    id: sunset
    trigger: sun
    offset: 00:30:00
  - event: sunrise
    id: sunrise
    trigger: sun
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: sunset
      sequence:
      - target:
          entity_id: input_boolean.es_ist_dunkel
        action: input_boolean.turn_on
        data: {}
    - conditions:
      - condition: trigger
        id: sunrise
      sequence:
      - target:
          entity_id: input_boolean.es_ist_dunkel
        action: input_boolean.turn_off
        data: {}
  mode: single
